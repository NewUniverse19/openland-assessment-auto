<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Nhận Xét Học Sinh - Openland</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #008172;
            --primary-dark: #00695c;
            --accent-color: #d1a200;
            --accent-light: #ffd54f;
            --secondary-color: #e8f5e9;
            --text-color: #2e3a4e;
            --border-color: #c5d9e8;
            --shadow: 0 4px 12px rgba(0, 129, 114, 0.15);
            --radius: 8px;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
            line-height: 1.5;
            color: var(--text-color);
            background: linear-gradient(135deg, #f8fdff 0%, #e6f7f4 100%);
            padding: 15px;
            min-height: 100vh;
            max-height: 100vh;
            overflow: hidden;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            border-radius: var(--radius);
            color: white;
            box-shadow: var(--shadow);
        }

        .app-title {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-title i {
            color: var(--accent-light);
        }

        .student-manager {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .container {
            display: flex;
            gap: 15px;
            height: calc(100vh - 100px);
            max-height: calc(100vh - 100px);
            overflow: hidden;
        }

        /* Form nhập liệu bên trái */
        .form-container {
            flex: 1;
            min-width: 350px;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 15px;
            display: flex;
            flex-direction: column;
            max-height: 100%;
            border-top: 4px solid var(--accent-color);
        }

        .form-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .form-content::-webkit-scrollbar {
            width: 6px;
        }

        .form-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .form-content::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
            border-radius: 3px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.4rem;
            padding-bottom: 8px;
            position: relative;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 30%;
            width: 40%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        h2 {
            color: var(--primary-dark);
            margin: 15px 0 12px 0;
            font-size: 1.2rem;
            padding-bottom: 5px;
            border-bottom: 1px solid #e0f2f1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h2 i {
            color: var(--accent-color);
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--primary-dark);
            font-size: 0.9rem;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-family: 'Roboto', sans-serif;
            font-size: 0.9rem;
            transition: all 0.2s;
            background-color: #fafafa;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-color);
            background-color: white;
            box-shadow: 0 0 0 2px rgba(209, 162, 0, 0.2);
        }

        .student-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .competency-row {
            background: linear-gradient(to right, #f8fffe, #fffaf0);
            border-radius: var(--radius);
            padding: 10px;
            margin-bottom: 10px;
            border-left: 3px solid var(--primary-color);
            transition: all 0.3s;
        }

        .competency-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .competency-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .competency-name i {
            color: var(--accent-color);
        }

        .star-display {
            font-size: 1.2rem;
            color: var(--accent-color);
            font-weight: 600;
        }

        .star-rating {
            display: flex;
            gap: 4px;
            margin: 8px 0;
            justify-content: center;
        }

        .star {
            font-size: 1.5rem;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .star:hover {
            transform: scale(1.2);
        }

        .star.active {
            color: var(--accent-color);
        }

        .suggest-container {
            margin: 10px 0;
            background-color: white;
            border-radius: var(--radius);
            padding: 10px;
            border: 1px solid var(--border-color);
        }

        .suggest-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .suggest-option {
            padding: 8px 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #eee;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            line-height: 1.3;
        }

        .suggest-option:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-color: var(--primary-color);
        }

        .custom-comment-container {
            margin-top: 10px;
            display: none;
        }

        .custom-comment-container.show {
            display: block;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            max-height: 120px;
        }

        .summary-box {
            background: linear-gradient(135deg, #f0f9f8, #fff9e6);
            border-radius: var(--radius);
            padding: 12px;
            margin-top: 10px;
            border: 1px dashed var(--accent-color);
        }

        .summary-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .g-level {
            color: var(--accent-color);
            padding: 4px 12px;
            background: #fff9e6;
            border-radius: 20px;
            border: 1px solid var(--accent-light);
        }

        /* Student Tabs */
        .student-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
            flex-wrap: nowrap;
            max-width: 100%;
        }

        .student-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .student-tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }

        .student-tabs::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 2px;
        }

        .student-tab {
            padding: 8px 15px;
            background: #f0f0f0;
            border-radius: var(--radius);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            border: 1px solid #ddd;
            font-size: 0.9rem;
            position: relative;
            min-width: 120px;
            text-align: center;
        }

        .student-tab:hover {
            background: #e0e0e0;
        }

        .student-tab.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 2px 6px rgba(0, 129, 114, 0.3);
        }

        .student-tab .close-tab {
            position: absolute;
            right: 5px;
            top: 5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .student-tab:hover .close-tab {
            opacity: 1;
        }

        .student-tab.active .close-tab {
            background: rgba(255, 255, 255, 0.5);
        }

        .add-student-btn {
            padding: 8px 15px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .add-student-btn:hover {
            background: #ff8f00;
            transform: translateY(-1px);
        }

        /* Action buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .btn {
            padding: 10px;
            border: none;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 129, 114, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #388e3c);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--accent-color), #ff8f00);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(209, 162, 0, 0.3);
        }

        /* Preview panel */
        .preview-container {
            flex: 1;
            min-width: 350px;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 15px;
            display: flex;
            flex-direction: column;
            max-height: 100%;
            border-top: 4px solid var(--primary-color);
        }

        .preview-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .preview-content::-webkit-scrollbar {
            width: 6px;
        }

        .preview-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .preview-content::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
            border-radius: 3px;
        }

        .preview-title {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0f2f1;
        }

        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            background: #f9f9f9;
            padding: 12px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
        }

        .preview-table th {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 8px 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--primary-dark);
        }

        .preview-table td {
            padding: 8px 10px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
        }

        .preview-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .teacher-signature {
            text-align: right;
            margin-top: 15px;
            font-style: italic;
            color: #666;
            font-size: 0.9rem;
            padding-top: 15px;
            border-top: 1px dashed var(--accent-color);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius);
            box-shadow: 0 6px 16px rgba(0, 129, 114, 0.4);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            background: linear-gradient(135deg, var(--error-color), #d32f2f);
        }

        .toast.warning {
            background: linear-gradient(135deg, var(--warning-color), #f57c00);
        }

        /* Modal for batch import */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Print styles - OPTIMIZED FOR SINGLE PAGE */
        @media print {
            @page {
                margin: 0.15in 0.3in; /* Giảm margin để tiết kiệm không gian */
                size: A4 portrait;
                marks: none;
            }
            
            body {
                background: white !important;
                padding: 0 !important;
                font-size: 10pt !important; /* Giảm kích thước font */
                margin: 0 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
                font-family: 'Times New Roman', serif !important;
                position: relative;
                line-height: 1.3 !important; /* Giảm line-height */
            }
            
            /* Header khi in - ĐÃ THU NHỎ */
            body::before {
                content: "";
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: 60px; /* Giảm chiều cao header */
                background-image: url('https://raw.githubusercontent.com/NewUniverse19/openland-assessment-auto/refs/heads/main/header.png');
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center top;
                z-index: 9999;
                background-color: white;
                border-bottom: 1px solid #00695c;
                margin: 0;
                padding: 0;
                page-break-inside: avoid;
            }
            
            /* Footer khi in - ĐÃ THU NHỎ */
            body::after {
                content: "";
                display: block;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 40px; /* Giảm chiều cao footer */
                background-image: url('https://raw.githubusercontent.com/NewUniverse19/openland-assessment-auto/refs/heads/main/footer.png');
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center bottom;
                z-index: 9999;
                background-color: white;
                border-top: 1px solid #e0e0e0;
                margin: 0;
                padding: 0;
                page-break-inside: avoid;
            }
            
            .app-header,
            .form-container,
            .action-buttons,
            .toast,
            .student-tabs,
            .add-student-btn,
            .modal {
                display: none !important;
            }
            
            .container {
                display: block !important;
                height: auto !important;
                max-height: none !important;
                margin-top: 70px !important; /* Giảm margin-top do header nhỏ hơn */
                margin-bottom: 50px !important; /* Giảm margin-bottom do footer nhỏ hơn */
            }
            
            .preview-container {
                box-shadow: none !important;
                padding: 0 !important;
                margin: 0 !important;
                width: 100% !important;
                border: none !important;
                page-break-inside: avoid !important;
                max-height: none !important;
                border-radius: 0 !important;
                background: white !important;
            }
            
            /* Thu nhỏ tiêu đề chính */
            .preview-title {
                font-size: 13pt !important; /* Giảm kích thước font */
                margin-top: 5pt !important; /* Giảm margin */
                margin-bottom: 10pt !important; /* Giảm margin */
                color: #00695c !important;
                border-bottom: 1.5pt solid #d1a200 !important; /* Giảm độ dày border */
                text-align: center;
                font-weight: bold;
                padding-bottom: 5pt; /* Giảm padding */
            }
            
            .preview-title::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 30%;
                width: 40%;
                height: 0.5pt;
                background: linear-gradient(90deg, transparent, #d1a200, transparent);
            }
            
            /* Thu nhỏ thông tin học sinh */
            .student-info {
                font-size: 9.5pt !important; /* Giảm kích thước font */
                margin-bottom: 10pt !important; /* Giảm margin */
                border: 1pt solid #e0f2f1 !important; /* Giảm độ dày border */
                background: #f8fdff !important;
                padding: 8pt !important; /* Giảm padding */
                border-radius: 4pt !important;
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 8pt !important; /* Giảm gap */
                box-shadow: 0 1pt 2pt rgba(0, 129, 114, 0.1) !important;
            }
            
            .student-info div {
                padding: 2pt 0; /* Giảm padding */
                border-bottom: 0.5pt dotted #e0e0e0; /* Giảm độ dày border */
            }
            
            .student-info div:last-child {
                border-bottom: none;
            }
            
            .student-info strong {
                color: #00695c;
                min-width: 90pt; /* Giảm min-width */
                display: inline-block;
                font-size: 9.5pt; /* Giảm kích thước font */
            }
            
            /* Tối ưu hóa bảng */
            .preview-table {
                font-size: 9.5pt !important; /* Giảm kích thước font */
                border: 1pt solid #e0f2f1 !important; /* Giảm độ dày border */
                margin-bottom: 8pt !important; /* Giảm margin */
                border-radius: 4pt !important;
                overflow: hidden;
                box-shadow: 0 1pt 2pt rgba(0, 129, 114, 0.1) !important;
                page-break-inside: avoid !important;
            }
            
            .preview-table th {
                background: linear-gradient(135deg, #00695c, #008172) !important;
                color: white !important;
                border-bottom: 1pt solid #004d40 !important; /* Giảm độ dày border */
                font-weight: bold;
                padding: 6pt 8pt !important; /* Giảm padding */
                font-size: 10pt; /* Giảm kích thước font */
            }
            
            .preview-table td {
                padding: 5pt 8pt !important; /* Giảm padding */
                border-bottom: 0.5pt solid #e0f2f1 !important; /* Giảm độ dày border */
                line-height: 1.2; /* Giảm line-height */
            }
            
            /* Thu nhỏ cột để tiết kiệm không gian */
            .preview-table th:first-child,
            .preview-table td:first-child {
                width: 30% !important; /* Giảm chiều rộng */
            }
            
            .preview-table th:nth-child(2),
            .preview-table td:nth-child(2) {
                width: 15% !important; /* Giảm chiều rộng */
                text-align: center;
            }
            
            .preview-table th:nth-child(3),
            .preview-table td:nth-child(3) {
                width: 55% !important; /* Tăng chiều rộng cho cột nhận xét */
            }
            
            .preview-table tr:nth-child(even) {
                background-color: #f8fdff !important;
            }
            
            /* Thu nhỏ phần đánh giá tổng quát */
            .preview-container > div:nth-last-child(3) {
                background: linear-gradient(135deg, #f0f9f8, #fff9e6) !important;
                border: 1pt solid #ffd54f !important; /* Giảm độ dày border */
                border-radius: 4pt !important;
                padding: 8pt !important; /* Giảm padding */
                margin: 8pt 0 !important; /* Giảm margin */
                box-shadow: 0 1pt 2pt rgba(209, 162, 0, 0.1) !important;
                page-break-inside: avoid !important;
            }
            
            .preview-container > div:nth-last-child(3) > div:first-child {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-weight: bold;
                color: #00695c;
                margin-bottom: 5pt; /* Giảm margin */
                font-size: 10pt; /* Giảm kích thước font */
            }
            
            .preview-container > div:nth-last-child(3) span:last-child {
                color: #d1a200;
                background: white;
                padding: 3pt 10pt; /* Giảm padding */
                border-radius: 15pt;
                border: 0.5pt solid #ffd54f; /* Giảm độ dày border */
                font-weight: bold;
                font-size: 10pt; /* Giảm kích thước font */
            }
            
            /* Thu nhỏ phần nhận xét chung */
            .preview-container > div:nth-last-child(2) {
                border: 1pt solid #e0f2f1 !important; /* Giảm độ dày border */
                border-radius: 4pt !important;
                padding: 8pt !important; /* Giảm padding */
                margin: 8pt 0 15pt 0 !important; /* Giảm margin */
                background: white !important;
                box-shadow: 0 1pt 2pt rgba(0, 129, 114, 0.1) !important;
                page-break-inside: avoid !important;
            }
            
            .preview-container > div:nth-last-child(2) h3 {
                color: #00695c !important;
                margin-bottom: 6pt !important; /* Giảm margin */
                font-size: 10pt !important; /* Giảm kích thước font */
                border-bottom: 0.5pt solid #ffd54f; /* Giảm độ dày border */
                padding-bottom: 4pt; /* Giảm padding */
                font-weight: bold;
            }
            
            .preview-container > div:nth-last-child(2) > div {
                min-height: 50pt; /* Giảm chiều cao tối thiểu */
                padding: 6pt; /* Giảm padding */
                border: 0.5pt solid #e0f2f1; /* Giảm độ dày border */
                border-radius: 3pt;
                background: #f8fdff;
                font-size: 9.5pt; /* Giảm kích thước font */
                line-height: 1.3; /* Giảm line-height */
            }
            
            /* Thu nhỏ phần chữ ký */
            .teacher-signature {
                text-align: right;
                margin-top: 15pt !important; /* Giảm margin */
                margin-bottom: 20pt !important; /* Giảm margin */
                font-style: italic;
                color: #666;
                font-size: 9.5pt; /* Giảm kích thước font */
                padding-top: 10pt; /* Giảm padding */
                border-top: 1pt dashed #d1a200; /* Giảm độ dày border */
                page-break-inside: avoid !important;
                position: relative;
                padding-right: 15pt; /* Giảm padding */
            }
            
            .teacher-signature > div:first-child {
                font-weight: bold;
                font-size: 10pt; /* Giảm kích thước font */
                color: #00695c;
                margin-bottom: 3pt; /* Giảm margin */
                padding-right: 30pt; /* Giảm padding */
            }
            
            .teacher-signature > div:last-child {
                color: #00695c;
                font-weight: bold;
                font-size: 9.5pt; /* Giảm kích thước font */
                padding-right: 30pt; /* Giảm padding */
            }
            
            /* Điều chỉnh sao đánh giá */
            .preview-table td:nth-child(2) {
                color: #d1a200;
                font-weight: bold;
                font-size: 10pt; /* Giảm kích thước font */
                text-align: center;
            }
            
            /* Giảm khoảng cách giữa các bảng */
            .preview-table + .preview-table {
                margin-top: -5pt; /* Giảm khoảng cách giữa 2 bảng */
            }
            
            /* Đảm bảo không bị tràn trang */
            .preview-container {
                max-height: calc(100vh - 120px) !important; /* Đảm bảo không vượt quá chiều cao trang */
                overflow: hidden !important;
            }
            
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                height: auto;
                max-height: none;
            }
            
            .form-container,
            .preview-container {
                max-height: 50vh;
            }
        }

        @media (max-width: 768px) {
            .student-info-grid,
            .student-info {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: 10px;
            }
            
            .app-header {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .student-manager {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header với quản lý học sinh -->
    <div class="app-header">
        <div class="app-title">
            <i class="fas fa-chalkboard-teacher"></i>
            CÔNG CỤ NHẬN XÉT HỌC SINH - OPENLAND
        </div>
        <div class="student-manager">
            <div class="student-tabs" id="student-tabs">
                <!-- Tabs sẽ được tạo động -->
            </div>
            <button class="add-student-btn" id="add-student-btn">
                <i class="fas fa-plus"></i> Thêm học sinh
            </button>
            <button class="btn btn-warning" id="batch-import-btn" style="padding: 8px 12px;">
                <i class="fas fa-file-import"></i> Nhập DS
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Form nhập liệu bên trái -->
        <div class="form-container">
            <div class="form-content" id="form-content">
                <!-- Nội dung form sẽ được tạo động -->
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" id="reset-btn">
                    <i class="fas fa-redo"></i> Làm mới
                </button>
                <button class="btn btn-success" id="copy-btn">
                    <i class="fas fa-copy"></i> Sao chép
                </button>
                <button class="btn btn-secondary" id="print-btn">
                    <i class="fas fa-print"></i> In phiếu
                </button>
                <button class="btn btn-primary" id="export-all-btn">
                    <i class="fas fa-file-export"></i> Xuất tất cả
                </button>
            </div>
        </div>
        
        <!-- Khung xem trước bên phải -->
        <div class="preview-container">
            <div class="preview-content" id="preview-content">
                <!-- Nội dung preview sẽ được tạo động -->
            </div>
        </div>
    </div>
    
    <!-- Modal nhập danh sách học sinh -->
    <div class="modal" id="batch-import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-users"></i> Nhập danh sách học sinh
                </div>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div style="margin-bottom: 15px;">
                <p>Nhập danh sách học sinh (mỗi học sinh trên một dòng):</p>
                <textarea id="student-list-input" rows="10" placeholder="Ví dụ:
Nguyễn Văn A
Trần Thị B
Lê Văn C
..." style="width: 100%; margin-top: 10px;"></textarea>
            </div>
            <div style="margin-bottom: 15px;">
                <label>Lớp chung cho tất cả học sinh:</label>
                <input type="text" id="batch-class-name" placeholder="Ví dụ: 10A1" style="width: 100%;">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" id="modal-cancel">Hủy</button>
                <button class="btn btn-success" id="modal-import">Nhập danh sách</button>
            </div>
        </div>
    </div>
    
    <!-- Toast thông báo -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Thao tác thành công!</span>
    </div>

    <script>
        // ==================== KHO DỮ LIỆU NHẬN XÉT ====================
        const commentBankByStars = {
            1: {
                grammar: [
                    "Cần ôn lại kiến thức nền tảng và luyện tập thường xuyên hơn.",
                    "Chưa nắm chắc nội dung đã học; cần thêm thời gian củng cố.",
                    "Thường xuyên mắc lỗi cơ bản; cần kèm sát khi làm bài.",
                    "Khả năng áp dụng kiến thức còn yếu; cần luyện theo hướng dẫn.",
                    "Chưa đạt yêu cầu của khóa; nên bổ sung bài tập ở nhà."
                ],
                vocabulary: [
                    "Cần củng cố vốn từ vựng cơ bản.",
                    "Chưa nhớ được từ vựng đã học; cần ôn tập nhiều hơn.",
                    "Phản xạ với từ vựng còn chậm; cần luyện tập thêm.",
                    "Sử dụng từ vựng chưa chính xác; cần chú ý ngữ cảnh.",
                    "Cần tăng cường học từ vựng mỗi ngày."
                ],
                communication: [
                    "Cần cải thiện sự tập trung và tính kỷ luật trong giờ học.",
                    "Còn ngại tham gia; nên tăng cường hoạt động luyện tập đơn giản.",
                    "Chưa hình thành thói quen tự sửa lỗi; cần nhắc nhở thường xuyên.",
                    "Cần học bổ trợ để theo kịp tiến độ lớp.",
                    "Khuyến nghị ôn tập lại các chủ điểm cơ bản trước khi học nâng cao."
                ],
                collaboration: [
                    "Còn ngại giao tiếp và hợp tác với bạn trong nhóm.",
                    "Cần học cách lắng nghe và tôn trọng ý kiến của người khác.",
                    "Chưa chủ động tham gia vào các hoạt động nhóm.",
                    "Cần rèn luyện kỹ năng làm việc nhóm cơ bản.",
                    "Chưa biết cách phối hợp hiệu quả với các thành viên."
                ],
                criticalThinking: [
                    "Còn gặp khó khăn trong việc phân tích và giải quyết vấn đề.",
                    "Chưa phát triển tư duy phản biện; cần hướng dẫn từng bước.",
                    "Thường bỏ qua các chi tiết quan trọng khi giải quyết vấn đề.",
                    "Cần luyện tập thêm các bài tập tư duy logic đơn giản.",
                    "Chưa biết cách đặt câu hỏi để làm rõ vấn đề."
                ],
                digitalLiteracy: [
                    "Còn hạn chế trong việc sử dụng công nghệ để học tập.",
                    "Chưa nhận thức được tầm quan trọng của kỹ năng số trong thời đại hiện nay.",
                    "Cần hướng dẫn cụ thể khi sử dụng các công cụ học tập trực tuyến.",
                    "Chưa biết cách tìm kiếm và đánh giá thông tin trên internet.",
                    "Cần nâng cao nhận thức về văn hóa toàn cầu và công dân số."
                ]
            },
            2: {
                grammar: [
                    "Có cố gắng nhưng kiến thức chưa vững; cần luyện thêm.",
                    "Nắm được một phần nội dung nhưng độ chính xác chưa ổn định.",
                    "Còn phụ thuộc vào gợi ý; cần tăng tính chủ động.",
                    "Thỉnh thoảng mắc lỗi cơ bản; cần ôn lại các điểm trọng tâm.",
                    "Tiến bộ chậm; nên luyện tập đều đặn ở nhà."
                ],
                vocabulary: [
                    "Đã hiểu bài nhưng vận dụng chưa linh hoạt.",
                    "Cần luyện thêm dạng bài quen thuộc để giảm sai sót.",
                    "Tham gia tương đối; nên tích cực phát biểu hơn.",
                    "Cần tăng tốc độ làm bài và độ tập trung.",
                    "Khuyến nghị làm thêm bài tập bổ trợ theo tuần."
                ],
                communication: [
                    "Cần luyện thêm dạng bài quen thuộc để giảm sai sót.",
                    "Tham gia tương đối; nên tích cực phát biểu hơn.",
                    "Cần tăng tốc độ làm bài và độ tập trung.",
                    "Khuyến nghị làm thêm bài tập bổ trợ theo tuần.",
                    "Cần cải thiện khả năng phản xạ trong giao tiếp."
                ],
                collaboration: [
                    "Đã bắt đầu tham gia vào hoạt động nhóm nhưng còn rụt rè.",
                    "Cần mạnh dạn hơn trong việc chia sẻ ý kiến cá nhân.",
                    "Đã có tiến bộ trong việc lắng nghe người khác.",
                    "Cần chủ động hơn trong việc phân công công việc nhóm.",
                    "Đã hiểu được tầm quan trọng của làm việc nhóm."
                ],
                criticalThinking: [
                    "Đã bắt đầu biết đặt câu hỏi về vấn đề được học.",
                    "Có tiến bộ trong việc nhận diện vấn đề cơ bản.",
                    "Cần luyện tập thêm để phát triển tư duy phân tích.",
                    "Đã có thể giải quyết các vấn đề đơn giản khi được hướng dẫn.",
                    "Cần tự tin hơn trong việc đưa ra giải pháp."
                ],
                digitalLiteracy: [
                    "Đã biết sử dụng cơ bản một số công cụ học tập trực tuyến.",
                    "Có nhận thức ban đầu về tầm quan trọng của kỹ năng số.",
                    "Cần luyện tập thêm để thành thạo các công cụ công nghệ.",
                    "Đã bắt đầu tìm kiếm thông tin trên internet dưới sự hướng dẫn.",
                    "Cần nâng cao hiểu biết về văn hóa các nước."
                ]
            },
            3: {
                grammar: [
                    "Đáp ứng yêu cầu cơ bản của khóa học.",
                    "Nắm được kiến thức trọng tâm và áp dụng ở mức ổn định.",
                    "Có tiến bộ đều; cần luyện thêm để nâng độ chính xác.",
                    "Hoàn thành tốt bài tập mức trung bình.",
                    "Vận dụng được kiến thức trong đa số tình huống quen thuộc."
                ],
                vocabulary: [
                    "Cần cải thiện một số lỗi nhỏ để đạt kết quả cao hơn.",
                    "Tham gia học tập tương đối tích cực.",
                    "Đã có nền tảng tốt để tiếp tục học lên.",
                    "Cần duy trì nhịp độ học và ôn tập hiện tại.",
                    "Khuyến khích luyện thêm để tăng sự tự tin."
                ],
                communication: [
                    "Tham gia học tập tương đối tích cực.",
                    "Đã có nền tảng tốt để tiếp tục học lên.",
                    "Cần duy trì nhịp độ học và ôn tập hiện tại.",
                    "Khuyến khích luyện thêm để tăng sự tự tin.",
                    "Giao tiếp ở mức cơ bản; cần luyện thêm để tự tin hơn."
                ],
                collaboration: [
                    "Tham gia tích cực vào các hoạt động nhóm.",
                    "Biết lắng nghe và tôn trọng ý kiến của các thành viên.",
                    "Có khả năng phối hợp khá tốt trong nhóm nhỏ.",
                    "Đôi khi còn ngại đưa ra ý kiến trước đám đông.",
                    "Có tinh thần hợp tác và hỗ trợ bạn bè."
                ],
                criticalThinking: [
                    "Có khả năng phân tích vấn đề ở mức độ trung bình.",
                    "Biết đặt câu hỏi để làm rõ thông tin khi cần thiết.",
                    "Có thể đề xuất giải pháp cho các vấn đề quen thuộc.",
                    "Cần luyện tập thêm để phát triển tư duy sáng tạo.",
                    "Đã có tư duy phản biện ở mức cơ bản."
                ],
                digitalLiteracy: [
                    "Sử dụng thành thạo các công cụ học tập trực tuyến cơ bản.",
                    "Có hiểu biết về văn hóa toàn cầu và công dân số.",
                    "Biết cách tìm kiếm và đánh giá thông tin trên internet.",
                    "Có khả năng sử dụng công nghệ để hỗ trợ học tập.",
                    "Nhận thức được tầm quan trọng của kỹ năng số trong thời đại 4.0."
                ]
            },
            4: {
                grammar: [
                    "Nắm vững hầu hết nội dung và vận dụng khá linh hoạt.",
                    "Tiến bộ rõ rệt; làm bài tốt và ổn định.",
                    "Thái độ học tập tích cực, chủ động trong giờ học.",
                    "Áp dụng kiến thức hiệu quả, ít mắc lỗi.",
                    "Có khả năng tự sửa lỗi khi được góp ý."
                ],
                vocabulary: [
                    "Thực hiện tốt các dạng bài tập của khóa.",
                    "Giao tiếp tự nhiên hơn; phản xạ tốt trong hoạt động lớp.",
                    "Có nền tảng tốt để học nâng cao.",
                    "Thường hoàn thành bài tập đúng hạn và chất lượng.",
                    "Kết quả học tập tốt so với mặt bằng chung."
                ],
                communication: [
                    "Giao tiếp tự nhiên hơn; phản xạ tốt trong hoạt động lớp.",
                    "Có nền tảng tốt để học nâng cao.",
                    "Thường hoàn thành bài tập đúng hạn và chất lượng.",
                    "Kết quả học tập tốt so với mặt bằng chung.",
                    "Tự tin hơn trong giao tiếp; phản xạ nhanh."
                ],
                collaboration: [
                    "Rất tích cực trong các hoạt động nhóm và hợp tác.",
                    "Có khả năng lãnh đạo nhóm nhỏ hiệu quả.",
                    "Biết cách phân công công việc và phối hợp nhịp nhàng.",
                    "Luôn hỗ trợ và khuyến khích các thành viên trong nhóm.",
                    "Giao tiếp hiệu quả để giải quyết mâu thuẫn trong nhóm."
                ],
                criticalThinking: [
                    "Có tư duy phân tích tốt, biết đặt câu hỏi sâu.",
                    "Có khả năng giải quyết vấn đề một cách sáng tạo.",
                    "Biết đánh giá và lựa chọn giải pháp tối ưu.",
                    "Có tư duy phản biện tốt, không chấp nhận thông tin một chiều.",
                    "Biết cách phân tích vấn đề từ nhiều góc độ khác nhau."
                ],
                digitalLiteracy: [
                    "Sử dụng thành thạo công nghệ để học tập và nghiên cứu.",
                    "Có hiểu biết sâu về văn hóa toàn cầu và xu hướng số.",
                    "Biết cách đánh giá và chọn lọc thông tin trên internet.",
                    "Có khả năng sử dụng các công cụ số để sáng tạo nội dung.",
                    "Nhận thức rõ về trách nhiệm công dân số và an toàn thông tin."
                ]
            },
            5: {
                grammar: [
                    "Nắm vững và vận dụng xuất sắc kiến thức đã học.",
                    "Tiến bộ vượt bậc; phản xạ nhanh và chính xác.",
                    "Rất chủ động, tích cực và có tinh thần học tập tốt.",
                    "Áp dụng linh hoạt; hiếm khi mắc lỗi.",
                    "Thể hiện tư duy ngôn ngữ tốt và tự tin trong lớp."
                ],
                vocabulary: [
                    "Luôn hoàn thành bài tập với chất lượng cao.",
                    "Có khả năng hỗ trợ bạn khác và làm việc nhóm hiệu quả.",
                    "Giao tiếp tự nhiên, diễn đạt rõ ràng và mạch lạc.",
                    "Sẵn sàng học lên trình độ cao hơn.",
                    "Kết quả học tập xuất sắc, vượt yêu cầu khóa học."
                ],
                communication: [
                    "Có khả năng hỗ trợ bạn khác và làm việc nhóm hiệu quả.",
                    "Giao tiếp tự nhiên, diễn đạt rõ ràng và mạch lạc.",
                    "Sẵn sàng học lên trình độ cao hơn.",
                    "Kết quả học tập xuất sắc, vượt yêu cầu khóa học.",
                    "Giao tiếp xuất sắc, tự tin và lưu loát."
                ],
                collaboration: [
                    "Xuất sắc trong việc hợp tác và làm việc nhóm.",
                    "Có khả năng lãnh đạo và điều phối nhóm hiệu quả.",
                    "Luôn tạo động lực và hỗ trợ các thành viên phát triển.",
                    "Giải quyết mâu thuẫn nhóm một cách khéo léo và hiệu quả.",
                    "Là cầu nối quan trọng trong giao tiếp giữa các thành viên."
                ],
                criticalThinking: [
                    "Có tư duy phản biện xuất sắc, luôn đặt câu hỏi sâu sắc.",
                    "Giải quyết vấn đề một cách sáng tạo và hiệu quả.",
                    "Có khả năng phân tích đa chiều và đề xuất giải pháp tối ưu.",
                    "Luôn tìm kiếm cách tiếp cận mới cho các vấn đề phức tạp.",
                    "Có tư duy hệ thống tốt, nhìn nhận vấn đề toàn diện."
                ],
                digitalLiteracy: [
                    "Thành thạo trong việc sử dụng công nghệ để học tập và sáng tạo.",
                    "Có hiểu biết sâu rộng về văn hóa toàn cầu và công nghệ số.",
                    "Có khả năng đánh giá, tổng hợp và sáng tạo nội dung số.",
                    "Nhận thức đầy đủ về trách nhiệm và đạo đức công dân số.",
                    "Có thể hướng dẫn người khác sử dụng công nghệ hiệu quả."
                ]
            }
        };
        
        const generalLevelComments = {
            "G1": [
                "Cần củng cố nền tảng và ôn tập đều đặn hằng tuần.",
                "Nên luyện thêm bài tập cơ bản để tăng độ chính xác.",
                "Cần cải thiện sự tập trung và chủ động trong giờ học.",
                "Khuyến nghị phụ huynh hỗ trợ lịch ôn tập tại nhà.",
                "Nên luyện nghe – nói ở mức đơn giản mỗi ngày.",
                "Cần tăng thói quen tự kiểm tra và sửa lỗi.",
                "Nên học bổ trợ để theo kịp tiến độ chương trình.",
                "Cần rèn kỹ năng làm bài theo hướng dẫn từng bước.",
                "Khuyến khích đặt mục tiêu nhỏ và theo dõi tiến bộ.",
                "Nếu có thể, nên học thêm buổi phụ đạo/ôn tập."
            ],
            "G2": [
                "Học sinh có tiến bộ, cần luyện thêm để ổn định kết quả.",
                "Nên tăng cường ôn tập để giảm lỗi ở các chủ điểm quen thuộc.",
                "Khuyến khích chủ động phát biểu và tham gia hoạt động lớp.",
                "Cần duy trì lịch luyện tập đều đặn ngoài giờ.",
                "Nên luyện thêm bài tập theo chủ đề để vận dụng tốt hơn.",
                "Khuyến khích tự sửa lỗi và ghi chú lỗi thường gặp.",
                "Cần cải thiện tốc độ phản xạ và sự tự tin.",
                "Có tiềm năng; cần kiên trì để bứt phá.",
                "Nên đặt mục tiêu tuần và tự kiểm tra cuối tuần.",
                "Tiếp tục cố gắng để đạt mức cao hơn."
            ],
            "G3": [
                "Học sinh học tốt và có thái độ tích cực.",
                "Nắm chắc nội dung; cần luyện thêm để tăng độ trôi chảy.",
                "Khuyến khích mở rộng vốn từ theo chủ đề đã học.",
                "Nên luyện thêm để tăng độ chính xác ở các chi tiết nhỏ.",
                "Tiếp tục duy trì thói quen ôn tập đều đặn.",
                "Có khả năng tự học tốt; nên làm thêm bài nâng cao vừa sức.",
                "Khuyến khích tham gia nhiều hoạt động giao tiếp hơn.",
                "Kết quả ổn định; tiếp tục phát huy.",
                "Nên luyện nghe – nói thường xuyên để tăng phản xạ.",
                "Sẵn sàng học lên cấp độ tiếp theo."
            ],
            "G4": [
                "Học sinh đạt kết quả xuất sắc và rất chủ động.",
                "Vận dụng linh hoạt; phản xạ tốt trong nhiều tình huống.",
                "Có thái độ học tập rất tốt và tinh thần tự học cao.",
                "Khuyến khích tham gia thêm hoạt động nâng cao để phát triển thêm.",
                "Nên mở rộng kỹ năng diễn đạt và thuyết trình.",
                "Tiếp tục phát huy để đạt thành tích cao hơn nữa.",
                "Có nền tảng vững; phù hợp học nội dung nâng cao.",
                "Khả năng giao tiếp tốt; nên luyện thêm để tăng độ tự nhiên.",
                "Thể hiện sự tiến bộ vượt bậc trong khóa học.",
                "Sẵn sàng cho khóa tiếp theo ở trình độ cao hơn."
            ]
        };

        // ==================== HỆ THỐNG QUẢN LÝ MULTI-STUDENT ====================
        let students = [];
        let currentStudentId = null;
        
        class Student {
            constructor(id, name, className = "") {
                this.id = id;
                this.name = name;
                this.className = className;
                this.teacherName = "";
                this.teacherPhone = "";
                this.ratings = {
                    grammar: 0,
                    vocabulary: 0,
                    communication: 0,
                    collaboration: 0,
                    criticalThinking: 0,
                    digitalLiteracy: 0
                };
                this.comments = {
                    grammar: "",
                    vocabulary: "",
                    communication: "",
                    collaboration: "",
                    criticalThinking: "",
                    digitalLiteracy: "",
                    general: ""
                };
                this.selectedComments = {
                    grammar: "",
                    vocabulary: "",
                    communication: "",
                    collaboration: "",
                    criticalThinking: "",
                    digitalLiteracy: "",
                    general: ""
                };
            }
            
            calculateLevel() {
                const total = Object.values(this.ratings).reduce((sum, rating) => sum + rating, 0);
                if (total <= 10) return "G1";
                if (total <= 18) return "G2";
                if (total <= 24) return "G3";
                return "G4";
            }
        }

        // ==================== HÀM TIỆN ÍCH ====================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            
            if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'warning') {
                toast.classList.add('warning');
            }
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.remove('error', 'warning');
            }, 3000);
        }

        function getStarsString(rating) {
            if (rating < 1 || rating > 5) return '☆☆☆☆☆';
            return '★'.repeat(rating) + '☆'.repeat(5 - rating);
        }

        function generateStudentId() {
            return 'student_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // ==================== QUẢN LÝ HỌC SINH ====================
        function addStudent(name, className = "") {
            const student = new Student(generateStudentId(), name, className);
            students.push(student);
            
            if (students.length === 1) {
                currentStudentId = student.id;
            }
            
            updateStudentTabs();
            renderFormForCurrentStudent();
            renderPreviewForCurrentStudent();
            
            return student;
        }

        function removeStudent(studentId) {
            if (students.length <= 1) {
                showToast('Phải có ít nhất 1 học sinh', 'warning');
                return;
            }
            
            const index = students.findIndex(s => s.id === studentId);
            if (index !== -1) {
                students.splice(index, 1);
                
                if (currentStudentId === studentId) {
                    currentStudentId = students[0]?.id || null;
                }
                
                updateStudentTabs();
                renderFormForCurrentStudent();
                renderPreviewForCurrentStudent();
                
                showToast('Đã xóa học sinh');
            }
        }

        function switchStudent(studentId) {
            currentStudentId = studentId;
            updateStudentTabs();
            renderFormForCurrentStudent();
            renderPreviewForCurrentStudent();
        }

        function updateStudentTabs() {
            const tabsContainer = document.getElementById('student-tabs');
            tabsContainer.innerHTML = '';
            
            students.forEach(student => {
                const tab = document.createElement('div');
                tab.className = `student-tab ${student.id === currentStudentId ? 'active' : ''}`;
                tab.textContent = student.name || `HS ${students.indexOf(student) + 1}`;
                
                const closeBtn = document.createElement('span');
                closeBtn.className = 'close-tab';
                closeBtn.innerHTML = '×';
                closeBtn.onclick = (e) => {
                    e.stopPropagation();
                    removeStudent(student.id);
                };
                
                tab.appendChild(closeBtn);
                tab.onclick = () => switchStudent(student.id);
                
                tabsContainer.appendChild(tab);
            });
        }

        function getCurrentStudent() {
            return students.find(s => s.id === currentStudentId) || students[0];
        }

        // ==================== RENDER FORM ====================
        function renderFormForCurrentStudent() {
            const formContent = document.getElementById('form-content');
            const student = getCurrentStudent();
            
            if (!student) {
                formContent.innerHTML = '<div style="text-align: center; padding: 20px;">Chưa có học sinh nào</div>';
                return;
            }
            
            formContent.innerHTML = `
                <h1><i class="fas fa-edit"></i> NHẬP THÔNG TIN</h1>
                
                <div class="form-group">
                    <label for="studentName"><i class="fas fa-user"></i> Họ và tên học sinh:</label>
                    <input type="text" id="studentName" value="${student.name}" placeholder="Nhập họ tên học sinh">
                </div>
                
                <div class="student-info-grid">
                    <div class="form-group">
                        <label for="className"><i class="fas fa-school"></i> Lớp:</label>
                        <input type="text" id="className" value="${student.className}" placeholder="Ví dụ: 10A1">
                    </div>
                    
                    <div class="form-group">
                        <label for="teacherName"><i class="fas fa-chalkboard-teacher"></i> Giáo viên:</label>
                        <input type="text" id="teacherName" value="${student.teacherName}" placeholder="Nhập tên giáo viên">
                    </div>
                    
                    <div class="form-group">
                        <label for="teacherPhone"><i class="fas fa-phone"></i> SĐT giáo viên:</label>
                        <input type="text" id="teacherPhone" value="${student.teacherPhone}" placeholder="Nhập số điện thoại">
                    </div>
                </div>
                
                <h2><i class="fas fa-star"></i> ĐÁNH GIÁ NĂNG LỰC</h2>
                
                ${renderCompetencyRow('grammar', 'Grammar', 'fas fa-book')}
                ${renderCompetencyRow('vocabulary', 'Vocabulary', 'fas fa-book-open')}
                ${renderCompetencyRow('communication', 'Communication', 'fas fa-comments')}
                
                <h2><i class="fas fa-globe-americas"></i> ĐÁNH GIÁ KỸ NĂNG TOÀN CẦU</h2>
                
                ${renderCompetencyRow('collaboration', 'Communication and Collaboration', 'fas fa-users')}
                ${renderCompetencyRow('criticalThinking', 'Critical thinking and Problem solving', 'fas fa-brain')}
                ${renderCompetencyRow('digitalLiteracy', 'Global awareness and Digital literacy', 'fas fa-laptop-code')}
                
                <div class="summary-box">
                    <div class="summary-stats">
                        <span><i class="fas fa-chart-bar"></i> Mức đánh giá:</span>
                        <span class="g-level" id="g-level">${student.calculateLevel()}</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="general-comment"><i class="fas fa-edit"></i> NHẬN XÉT CHUNG:</label>
                        <textarea id="general-comment" rows="3">${student.comments.general}</textarea>
                    </div>
                    
                    <div class="suggest-container">
                        <label><i class="fas fa-lightbulb"></i> Gợi ý nhận xét chung:</label>
                        <div class="suggest-options" id="general-suggestions">
                            ${renderGeneralSuggestions(student)}
                        </div>
                    </div>
                </div>
            `;
            
            attachFormEvents();
            updateStarDisplayForStudent(student);
        }

        function renderCompetencyRow(competency, displayName, icon) {
            const student = getCurrentStudent();
            const rating = student.ratings[competency] || 0;
            
            return `
                <div class="competency-row" id="${competency}-row">
                    <div class="competency-header">
                        <span class="competency-name"><i class="${icon}"></i> ${displayName}</span>
                        <span class="star-display" id="${competency}-star-display">${getStarsString(rating)}</span>
                    </div>
                    <div class="star-rating" data-competency="${competency}">
                        ${[1,2,3,4,5].map(val => `
                            <span class="star ${rating >= val ? 'active' : ''}" data-value="${val}">★</span>
                        `).join('')}
                    </div>
                    
                    <div class="suggest-container">
                        <label><i class="fas fa-lightbulb"></i> Chọn nhận xét mẫu:</label>
                        <div class="suggest-options" id="${competency}-suggestions">
                            ${renderSuggestionsForCompetency(competency, rating)}
                        </div>
                        <button class="btn btn-secondary" data-competency="${competency}" style="margin-top: 8px; width: 100%; padding: 8px; font-size: 0.85rem;">
                            <i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh
                        </button>
                    </div>
                    
                    <div class="custom-comment-container" id="${competency}-custom-container">
                        <label for="${competency}-comment"><i class="fas fa-edit"></i> Nhận xét tùy chỉnh:</label>
                        <textarea id="${competency}-comment" rows="2">${student.comments[competency] || ''}</textarea>
                    </div>
                </div>
            `;
        }

        function renderSuggestionsForCompetency(competency, rating) {
            if (!rating || rating < 1) {
                return '<div class="suggest-option">Vui lòng chọn mức sao trước</div>';
            }
            
            const comments = commentBankByStars[rating]?.[competency] || [];
            if (comments.length === 0) {
                return '<div class="suggest-option">Không có gợi ý cho mức này</div>';
            }
            
            const student = getCurrentStudent();
            const selectedComment = student.selectedComments[competency];
            
            return comments.map((comment, index) => `
                <div class="suggest-option ${selectedComment === comment ? 'selected' : ''}" 
                     data-index="${index}"
                     onclick="selectSuggestion('${competency}', ${index})">
                    ${comment}
                </div>
            `).join('');
        }

        function renderGeneralSuggestions(student) {
            const gLevel = student.calculateLevel();
            const comments = generalLevelComments[gLevel] || [];
            const selectedComment = student.selectedComments.general;
            
            if (comments.length === 0) {
                return '<div class="suggest-option">Không có gợi ý</div>';
            }
            
            return comments.map((comment, index) => `
                <div class="suggest-option ${selectedComment === comment ? 'selected' : ''}" 
                     data-index="${index}"
                     onclick="selectGeneralSuggestion(${index})">
                    ${comment}
                </div>
            `).join('');
        }

        // ==================== EVENT HANDLERS ====================
        function attachFormEvents() {
            const student = getCurrentStudent();
            
            // Input events
            document.getElementById('studentName')?.addEventListener('input', (e) => {
                student.name = e.target.value;
                updateStudentTabs();
            });
            
            document.getElementById('className')?.addEventListener('input', (e) => {
                student.className = e.target.value;
            });
            
            document.getElementById('teacherName')?.addEventListener('input', (e) => {
                student.teacherName = e.target.value;
            });
            
            document.getElementById('teacherPhone')?.addEventListener('input', (e) => {
                student.teacherPhone = e.target.value;
            });
            
            // Star rating events
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const competency = this.closest('.star-rating').dataset.competency;
                    const value = parseInt(this.dataset.value);
                    
                    student.ratings[competency] = value;
                    
                    // Update star display
                    const stars = this.parentElement.querySelectorAll('.star');
                    stars.forEach((s, index) => {
                        if (index < value) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    
                    // Update star display text
                    document.getElementById(`${competency}-star-display`).textContent = getStarsString(value);
                    
                    // Reload suggestions
                    const suggestionsContainer = document.getElementById(`${competency}-suggestions`);
                    if (suggestionsContainer) {
                        suggestionsContainer.innerHTML = renderSuggestionsForCompetency(competency, value);
                    }
                    
                    // Update level
                    document.getElementById('g-level').textContent = student.calculateLevel();
                    
                    // Update general suggestions
                    const generalSuggestions = document.getElementById('general-suggestions');
                    if (generalSuggestions) {
                        generalSuggestions.innerHTML = renderGeneralSuggestions(student);
                    }
                    
                    renderPreviewForCurrentStudent();
                });
            });
            
            // Comment input events
            ['grammar', 'vocabulary', 'communication', 'collaboration', 'criticalThinking', 'digitalLiteracy'].forEach(competency => {
                const textarea = document.getElementById(`${competency}-comment`);
                if (textarea) {
                    textarea.addEventListener('input', (e) => {
                        student.comments[competency] = e.target.value;
                        renderPreviewForCurrentStudent();
                    });
                }
            });
            
            document.getElementById('general-comment')?.addEventListener('input', (e) => {
                student.comments.general = e.target.value;
                renderPreviewForCurrentStudent();
            });
            
            // Custom comment button events
            document.querySelectorAll('.btn[data-competency]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const competency = this.dataset.competency;
                    const container = document.getElementById(`${competency}-custom-container`);
                    
                    if (container.classList.contains('show')) {
                        container.classList.remove('show');
                        this.innerHTML = '<i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh';
                    } else {
                        container.classList.add('show');
                        this.innerHTML = '<i class="fas fa-times"></i> Đóng nhập tùy chỉnh';
                    }
                });
            });
        }

        // Global functions for suggestions
        window.selectSuggestion = function(competency, index) {
            const student = getCurrentStudent();
            const rating = student.ratings[competency];
            const comments = commentBankByStars[rating]?.[competency] || [];
            
            if (comments[index]) {
                student.selectedComments[competency] = comments[index];
                student.comments[competency] = comments[index];
                
                // Update textarea
                const textarea = document.getElementById(`${competency}-comment`);
                if (textarea) {
                    textarea.value = comments[index];
                }
                
                // Update suggestions display
                const suggestionsContainer = document.getElementById(`${competency}-suggestions`);
                if (suggestionsContainer) {
                    suggestionsContainer.innerHTML = renderSuggestionsForCompetency(competency, rating);
                }
                
                renderPreviewForCurrentStudent();
            }
        };

        window.selectGeneralSuggestion = function(index) {
            const student = getCurrentStudent();
            const gLevel = student.calculateLevel();
            const comments = generalLevelComments[gLevel] || [];
            
            if (comments[index]) {
                student.selectedComments.general = comments[index];
                student.comments.general = comments[index];
                
                // Update textarea
                const textarea = document.getElementById('general-comment');
                if (textarea) {
                    textarea.value = comments[index];
                }
                
                // Update suggestions display
                const suggestionsContainer = document.getElementById('general-suggestions');
                if (suggestionsContainer) {
                    suggestionsContainer.innerHTML = renderGeneralSuggestions(student);
                }
                
                renderPreviewForCurrentStudent();
            }
        };

        function updateStarDisplayForStudent(student) {
            ['grammar', 'vocabulary', 'communication', 'collaboration', 'criticalThinking', 'digitalLiteracy'].forEach(competency => {
                const display = document.getElementById(`${competency}-star-display`);
                if (display) {
                    display.textContent = getStarsString(student.ratings[competency]);
                }
            });
            
            const gLevelDisplay = document.getElementById('g-level');
            if (gLevelDisplay) {
                gLevelDisplay.textContent = student.calculateLevel();
            }
        }

        // ==================== RENDER PREVIEW ====================
        function renderPreviewForCurrentStudent() {
            const previewContent = document.getElementById('preview-content');
            const student = getCurrentStudent();
            
            if (!student) {
                previewContent.innerHTML = '<div style="text-align: center; padding: 20px;">Chưa có học sinh nào</div>';
                return;
            }
            
            previewContent.innerHTML = `
                <div class="preview-title">PHIẾU NHẬN XÉT QUÁ TRÌNH HỌC TẬP</div>
                
                <div class="student-info">
                    <div>
                        <strong>Họ và tên học sinh:</strong> 
                        <span id="preview-studentName">${student.name || '___________________'}</span>
                    </div>
                    <div>
                        <strong>Lớp:</strong> 
                        <span id="preview-className">${student.className || '___________________'}</span>
                    </div>
                    <div>
                        <strong>Giáo viên:</strong> 
                        <span id="preview-teacherName">${student.teacherName || '___________________'}</span>
                    </div>
                    <div>
                        <strong>SĐT giáo viên:</strong> 
                        <span id="preview-teacherPhone">${student.teacherPhone || '___________________'}</span>
                    </div>
                </div>
                
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th width="35%">Năng lực</th>
                            <th width="15%">Mức đánh giá</th>
                            <th>Nhận xét chi tiết</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${renderPreviewRow('grammar', 'Grammar')}
                        ${renderPreviewRow('vocabulary', 'Vocabulary')}
                        ${renderPreviewRow('communication', 'Communication')}
                    </tbody>
                </table>
                
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th width="35%">Kỹ năng toàn cầu</th>
                            <th width="15%">Mức đánh giá</th>
                            <th>Nhận xét chi tiết</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${renderPreviewRow('collaboration', 'Communication and Collaboration')}
                        ${renderPreviewRow('criticalThinking', 'Critical thinking and Problem solving')}
                        ${renderPreviewRow('digitalLiteracy', 'Global awareness and Digital literacy')}
                    </tbody>
                </table>
                
                <div style="margin: 10px 0; padding: 10px; background: #f0f9f8; border-radius: var(--radius); border: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; font-weight: 600; color: var(--primary-dark);">
                        <span><i class="fas fa-trophy" style="color: var(--accent-color);"></i> Mức đánh giá tổng quát:</span>
                        <span style="color: var(--accent-color);">${student.calculateLevel()}</span>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: var(--primary-dark); margin-bottom: 8px; font-size: 1rem;">NHẬN XÉT CHUNG CỦA GIÁO VIÊN</h3>
                    <div style="min-height: 80px; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); background-color: #f9f9f9; font-size: 0.9rem; line-height: 1.5;">
                        ${student.comments.general || 'Chưa có nhận xét chung.'}
                    </div>
                </div>
                
                <div class="teacher-signature">
                    <div style="margin-top: 30px; font-weight: 700; font-size: 1rem;">_________________________</div>
                    <div style="margin-top: 5px; font-size: 0.9rem; color: var(--primary-dark);">
                        <strong>GIÁO VIÊN KÝ TÊN</strong>
                    </div>
                </div>
            `;
        }

        function renderPreviewRow(competency, displayName) {
            const student = getCurrentStudent();
            return `
                <tr>
                    <td><strong>${displayName}</strong></td>
                    <td>${getStarsString(student.ratings[competency])}</td>
                    <td>${student.comments[competency] || 'Chưa có nhận xét'}</td>
                </tr>
            `;
        }

        // ==================== BATCH IMPORT ====================
        function showBatchImportModal() {
            document.getElementById('batch-import-modal').classList.add('show');
        }

        function hideBatchImportModal() {
            document.getElementById('batch-import-modal').classList.remove('show');
            document.getElementById('student-list-input').value = '';
            document.getElementById('batch-class-name').value = '';
        }

        function importStudentList() {
            const input = document.getElementById('student-list-input').value.trim();
            const className = document.getElementById('batch-class-name').value.trim();
            
            if (!input) {
                showToast('Vui lòng nhập danh sách học sinh', 'warning');
                return;
            }
            
            const studentNames = input.split('\n')
                .map(name => name.trim())
                .filter(name => name.length > 0);
            
            if (studentNames.length === 0) {
                showToast('Không tìm thấy tên học sinh hợp lệ', 'warning');
                return;
            }
            
            // Clear existing students
            students = [];
            currentStudentId = null;
            
            // Add new students
            studentNames.forEach(name => {
                addStudent(name, className);
            });
            
            hideBatchImportModal();
            showToast(`Đã nhập ${studentNames.length} học sinh`, 'success');
        }

        // ==================== EXPORT FUNCTIONS ====================
        function copyCurrentToClipboard() {
            const student = getCurrentStudent();
            if (!student) {
                showToast('Không có học sinh nào', 'warning');
                return;
            }
            
            const text = generateStudentReport(student);
            
            navigator.clipboard.writeText(text)
                .then(() => {
                    showToast('Đã sao chép nhận xét!');
                })
                .catch(err => {
                    console.error('Lỗi sao chép:', err);
                    showToast('Lỗi sao chép!', 'error');
                });
        }

        function exportAllStudents() {
            if (students.length === 0) {
                showToast('Không có học sinh nào', 'warning');
                return;
            }
            
            let allReports = '';
            students.forEach((student, index) => {
                allReports += generateStudentReport(student);
                if (index < students.length - 1) {
                    allReports += '\n' + '='.repeat(50) + '\n\n';
                }
            });
            
            const blob = new Blob([allReports], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nhan_xet_hoc_sinh_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast(`Đã xuất ${students.length} học sinh`);
        }

        function generateStudentReport(student) {
            return `PHIẾU NHẬN XÉT QUÁ TRÌNH HỌC TẬP

Họ và tên học sinh: ${student.name || '___________________'}
Lớp: ${student.className || '___________________'}
Giáo viên: ${student.teacherName || '___________________'}

ĐÁNH GIÁ NĂNG LỰC
1. Grammar: ${getStarsString(student.ratings.grammar)}
   ${student.comments.grammar || 'Chưa có nhận xét'}

2. Vocabulary: ${getStarsString(student.ratings.vocabulary)}
   ${student.comments.vocabulary || 'Chưa có nhận xét'}

3. Communication: ${getStarsString(student.ratings.communication)}
   ${student.comments.communication || 'Chưa có nhận xét'}

ĐÁNH GIÁ KỸ NĂNG TOÀN CẦU
4. Communication and Collaboration: ${getStarsString(student.ratings.collaboration)}
   ${student.comments.collaboration || 'Chưa có nhận xét'}

5. Critical thinking and Problem solving: ${getStarsString(student.ratings.criticalThinking)}
   ${student.comments.criticalThinking || 'Chưa có nhận xét'}

6. Global awareness and Digital literacy: ${getStarsString(student.ratings.digitalLiteracy)}
   ${student.comments.digitalLiteracy || 'Chưa có nhận xét'}

Mức đánh giá tổng quát: ${student.calculateLevel()}

NHẬN XÉT CHUNG CỦA GIÁO VIÊN:
${student.comments.general || 'Chưa có nhận xét chung.'}

Giáo viên ký tên:
_________________________`;
        }

        function resetCurrentStudent() {
            const student = getCurrentStudent();
            if (!student) return;
            
            // Reset ratings
            Object.keys(student.ratings).forEach(key => {
                student.ratings[key] = 0;
            });
            
            // Reset comments
            Object.keys(student.comments).forEach(key => {
                student.comments[key] = '';
            });
            
            Object.keys(student.selectedComments).forEach(key => {
                student.selectedComments[key] = '';
            });
            
            // Reset basic info
            student.teacherName = '';
            student.teacherPhone = '';
            
            renderFormForCurrentStudent();
            renderPreviewForCurrentStudent();
            showToast('Đã làm mới thông tin học sinh');
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Add first student
            addStudent("Học sinh 1", "10A1");
            
            // Event listeners for buttons
            document.getElementById('add-student-btn').addEventListener('click', () => {
                const student = addStudent(`Học sinh ${students.length + 1}`);
                switchStudent(student.id);
                showToast('Đã thêm học sinh mới');
            });
            
            document.getElementById('batch-import-btn').addEventListener('click', showBatchImportModal);
            document.getElementById('modal-close').addEventListener('click', hideBatchImportModal);
            document.getElementById('modal-cancel').addEventListener('click', hideBatchImportModal);
            document.getElementById('modal-import').addEventListener('click', importStudentList);
            
            document.getElementById('reset-btn').addEventListener('click', resetCurrentStudent);
            document.getElementById('copy-btn').addEventListener('click', copyCurrentToClipboard);
            document.getElementById('print-btn').addEventListener('click', () => window.print());
            document.getElementById('export-all-btn').addEventListener('click', exportAllStudents);
            
            // Close modal on outside click
            document.getElementById('batch-import-modal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('batch-import-modal')) {
                    hideBatchImportModal();
                }
            });
            
            showToast('Chào mừng đến với công cụ nhận xét học sinh!', 'success');
        });
    </script>
</body>
</html>
