<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Nhận Xét Học Sinh - Openland</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2596be;
            --primary-dark: #1c7795;
            --secondary-color: #f0f8ff;
            --text-color: #333;
            --border-color: #ddd;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Form nhập liệu bên trái */
        .form-container {
            flex: 1;
            min-width: 350px;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            max-height: 95vh;
            overflow-y: auto;
        }

        .form-container::-webkit-scrollbar {
            width: 6px;
        }

        .form-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .form-container::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.6rem;
            padding-bottom: 8px;
            position: relative;
        }

        h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            width: 50%;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        }

        h2 {
            color: var(--primary-dark);
            margin: 20px 0 15px 0;
            font-size: 1.3rem;
            padding-bottom: 5px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h2 i {
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-family: 'Roboto', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 150, 190, 0.2);
        }

        .student-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 10px;
        }

        .competency-row {
            background-color: var(--secondary-color);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary-color);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .competency-row:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .competency-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .competency-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .star-rating {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }

        .star {
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
        }

        .star:hover {
            transform: scale(1.2);
        }

        .star:hover,
        .star.active {
            color: #ffd700;
        }

        .suggest-container {
            margin: 10px 0;
            background-color: white;
            border-radius: var(--radius);
            padding: 10px;
            border: 1px solid var(--border-color);
        }

        .suggest-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .suggest-option {
            padding: 8px 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #eee;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .suggest-option:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .custom-comment-container {
            margin-top: 10px;
            display: none;
        }

        .custom-comment-container.show {
            display: block;
        }

        .summary-box {
            background-color: #f9f9f9;
            border-radius: var(--radius);
            padding: 15px;
            margin-top: 15px;
            border: 2px dashed var(--primary-color);
        }

        .summary-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 1rem;
        }

        .g-level {
            color: #e67e22;
            padding: 4px 12px;
            background-color: #fff8e1;
            border-radius: 20px;
            border: 1px solid #ffd54f;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px;
            border: none;
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(37, 150, 190, 0.3);
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }

        /* Khung xem trước bên phải */
        .preview-container {
            flex: 1;
            min-width: 350px;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            height: fit-content;
            max-height: 95vh;
            overflow-y: auto;
        }

        .preview-container::-webkit-scrollbar {
            width: 6px;
        }

        .preview-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .preview-container::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        .preview-title {
            text-align: center;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-transform: uppercase;
            position: relative;
            padding-bottom: 10px;
        }

        .preview-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            width: 60%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        }

        .preview-section {
            margin-bottom: 15px;
        }

        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
        }

        .preview-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: 500;
            border-bottom: 2px solid var(--primary-dark);
        }

        .preview-table td {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
        }

        .preview-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .preview-table tr:last-child td {
            border-bottom: none;
        }

        .teacher-signature {
            text-align: right;
            margin-top: 20px;
            font-style: italic;
            color: #666;
            font-size: 0.95rem;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            background-color: #e74c3c;
        }

        .toast.warning {
            background-color: var(--warning-color);
        }

        .quick-templates {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .template-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .template-btn {
            padding: 8px 15px;
            background-color: white;
            border: 1px solid var(--primary-color);
            border-radius: 20px;
            color: var(--primary-color);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .template-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .progress-indicator {
            height: 4px;
            background-color: #eee;
            border-radius: 2px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.5s;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .container {
                flex-direction: column;
            }
            
            .form-container,
            .preview-container {
                max-height: none;
                height: auto;
            }
        }

        @media (max-width: 576px) {
            .student-info-grid,
            .student-info {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .preview-title {
                font-size: 1.2rem;
            }
        }

        /* Print styles - Tối ưu cho in ấn không timestamp */
        @media print {
            @page {
                margin: 0.5in;
                size: A4 portrait;
            }
            
            body {
                background-color: white;
                padding: 0;
                font-size: 11pt;
                margin: 0;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            .form-container,
            .action-buttons,
            .toast,
            .quick-templates,
            .progress-indicator,
            .suggest-container,
            .custom-comment-container,
            .summary-stats .total-stars,
            .star-rating,
            .suggest-btn {
                display: none !important;
            }
            
            .preview-container {
                box-shadow: none;
                padding: 0;
                margin: 0;
                width: 100%;
                max-width: 100%;
                min-width: 100%;
                max-height: none;
                overflow: visible;
                border: none;
                page-break-inside: avoid;
            }
            
            .preview-title {
                font-size: 14pt;
                margin-top: 0;
                margin-bottom: 20pt;
                padding-bottom: 8pt;
                color: black !important;
            }
            
            .preview-title:after {
                background: black;
            }
            
            .preview-table {
                font-size: 10pt;
                border: 1pt solid black;
                page-break-inside: avoid;
            }
            
            .preview-table th {
                background-color: #f0f0f0 !important;
                color: black !important;
                border-bottom: 1pt solid black;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .student-info {
                font-size: 10pt;
                margin-bottom: 15pt;
            }
            
            .teacher-signature {
                margin-top: 30pt;
                font-size: 10pt;
            }
            
            /* Ẩn URL và ngày in trên bản in */
            @page {
                marks: none;
            }
            
            /* Ẩn header và footer tự động của trình duyệt */
            @page :first {
                margin-top: 0;
            }
            
            /* Tắt tiêu đề và chân trang mặc định */
            body:after {
                content: none !important;
            }
            
            /* Đảm bảo màu sắc in đúng */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Form nhập liệu bên trái -->
        <div class="form-container">
            <h1><i class="fas fa-chalkboard-teacher"></i> CÔNG CỤ NHẬN XÉT HỌC SINH</h1>
            
            <!-- Thanh tiến độ -->
            <div class="progress-indicator">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            
            <!-- Thông tin học sinh -->
            <h2><i class="fas fa-user-graduate"></i> THÔNG TIN HỌC SINH</h2>
            <div class="form-group">
                <label for="studentName"><i class="fas fa-user"></i> Họ và tên học sinh:</label>
                <input type="text" id="studentName" placeholder="Nhập họ tên học sinh">
            </div>
            
            <div class="student-info-grid">
                <div class="form-group">
                    <label for="className"><i class="fas fa-school"></i> Lớp:</label>
                    <input type="text" id="className" placeholder="Ví dụ: 10A1">
                </div>
                
                <div class="form-group">
                    <label for="teacherName"><i class="fas fa-chalkboard-teacher"></i> Giáo viên:</label>
                    <input type="text" id="teacherName" placeholder="Nhập tên giáo viên">
                </div>
                
                <div class="form-group">
                    <label for="teacherPhone"><i class="fas fa-phone"></i> SĐT giáo viên:</label>
                    <input type="text" id="teacherPhone" placeholder="Nhập số điện thoại">
                </div>
            </div>
            
            <!-- Mẫu nhanh -->
            <div class="quick-templates">
                <h3 style="margin-top: 0; font-size: 1rem;"><i class="fas fa-bolt"></i> Mẫu nhanh</h3>
                <div class="template-buttons">
                    <button class="template-btn" data-template="excellent">Học sinh xuất sắc</button>
                    <button class="template-btn" data-template="good">Học sinh khá</button>
                    <button class="template-btn" data-template="average">Học sinh trung bình</button>
                    <button class="template-btn" data-template="needs-improvement">Cần cải thiện</button>
                </div>
            </div>
            
            <!-- Đánh giá năng lực -->
            <h2><i class="fas fa-star"></i> ĐÁNH GIÁ NĂNG LỰC</h2>
            
            <!-- Grammar -->
            <div class="competency-row" id="grammar-row">
                <div class="competency-header">
                    <span class="competency-name"><i class="fas fa-book"></i> Grammar</span>
                    <span class="star-display" id="grammar-star-display">☆☆☆☆☆</span>
                </div>
                <div class="star-rating" data-competency="grammar">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>
                
                <div class="suggest-container">
                    <label>Chọn nhận xét mẫu:</label>
                    <div class="suggest-options" id="grammar-suggestions"></div>
                    <button class="suggest-btn" data-competency="grammar" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh
                    </button>
                </div>
                
                <div class="custom-comment-container" id="grammar-custom-container">
                    <label for="grammar-comment">Nhận xét tùy chỉnh:</label>
                    <textarea id="grammar-comment" rows="2" placeholder="Nhập nhận xét của bạn..."></textarea>
                </div>
            </div>
            
            <!-- Vocabulary -->
            <div class="competency-row" id="vocabulary-row">
                <div class="competency-header">
                    <span class="competency-name"><i class="fas fa-book-open"></i> Vocabulary</span>
                    <span class="star-display" id="vocabulary-star-display">☆☆☆☆☆</span>
                </div>
                <div class="star-rating" data-competency="vocabulary">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>
                
                <div class="suggest-container">
                    <label>Chọn nhận xét mẫu:</label>
                    <div class="suggest-options" id="vocabulary-suggestions"></div>
                    <button class="suggest-btn" data-competency="vocabulary" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh
                    </button>
                </div>
                
                <div class="custom-comment-container" id="vocabulary-custom-container">
                    <label for="vocabulary-comment">Nhận xét tùy chỉnh:</label>
                    <textarea id="vocabulary-comment" rows="2" placeholder="Nhập nhận xét của bạn..."></textarea>
                </div>
            </div>
            
            <!-- Communication -->
            <div class="competency-row" id="communication-row">
                <div class="competency-header">
                    <span class="competency-name"><i class="fas fa-comments"></i> Communication</span>
                    <span class="star-display" id="communication-star-display">☆☆☆☆☆</span>
                </div>
                <div class="star-rating" data-competency="communication">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>
                
                <div class="suggest-container">
                    <label>Chọn nhận xét mẫu:</label>
                    <div class="suggest-options" id="communication-suggestions"></div>
                    <button class="suggest-btn" data-competency="communication" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh
                    </button>
                </div>
                
                <div class="custom-comment-container" id="communication-custom-container">
                    <label for="communication-comment">Nhận xét tùy chỉnh:</label>
                    <textarea id="communication-comment" rows="2" placeholder="Nhập nhận xét của bạn..."></textarea>
                </div>
            </div>
            
            <!-- Đánh giá Global Skills -->
            <h2><i class="fas fa-globe-americas"></i> ĐÁNH GIÁ GLOBAL SKILLS</h2>
            
            <!-- Communication and Collaboration -->
            <div class="competency-row" id="collaboration-row">
                <div class="competency-header">
                    <span class="competency-name"><i class="fas fa-users"></i> Communication and Collaboration</span>
                    <span class="star-display" id="collaboration-star-display">☆☆☆☆☆</span>
                </div>
                <div class="star-rating" data-competency="collaboration">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>
                
                <div class="suggest-container">
                    <label>Chọn nhận xét mẫu:</label>
                    <div class="suggest-options" id="collaboration-suggestions"></div>
                    <button class="suggest-btn" data-competency="collaboration" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh
                    </button>
                </div>
                
                <div class="custom-comment-container" id="collaboration-custom-container">
                    <label for="collaboration-comment">Nhận xét tùy chỉnh:</label>
                    <textarea id="collaboration-comment" rows="2" placeholder="Nhập nhận xét của bạn..."></textarea>
                </div>
            </div>
            
            <!-- Critical thinking and Problem solving -->
            <div class="competency-row" id="critical-thinking-row">
                <div class="competency-header">
                    <span class="competency-name"><i class="fas fa-brain"></i> Critical thinking and Problem solving</span>
                    <span class="star-display" id="critical-thinking-star-display">☆☆☆☆☆</span>
                </div>
                <div class="star-rating" data-competency="criticalThinking">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>
                
                <div class="suggest-container">
                    <label>Chọn nhận xét mẫu:</label>
                    <div class="suggest-options" id="critical-thinking-suggestions"></div>
                    <button class="suggest-btn" data-competency="criticalThinking" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh
                    </button>
                </div>
                
                <div class="custom-comment-container" id="critical-thinking-custom-container">
                    <label for="critical-thinking-comment">Nhận xét tùy chỉnh:</label>
                    <textarea id="critical-thinking-comment" rows="2" placeholder="Nhập nhận xét của bạn..."></textarea>
                </div>
            </div>
            
            <!-- Global awareness and Digital literacy -->
            <div class="competency-row" id="digital-literacy-row">
                <div class="competency-header">
                    <span class="competency-name"><i class="fas fa-laptop-code"></i> Global awareness and Digital literacy</span>
                    <span class="star-display" id="digital-literacy-star-display">☆☆☆☆☆</span>
                </div>
                <div class="star-rating" data-competency="digitalLiteracy">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>
                
                <div class="suggest-container">
                    <label>Chọn nhận xét mẫu:</label>
                    <div class="suggest-options" id="digital-literacy-suggestions"></div>
                    <button class="suggest-btn" data-competency="digitalLiteracy" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh
                    </button>
                </div>
                
                <div class="custom-comment-container" id="digital-literacy-custom-container">
                    <label for="digital-literacy-comment">Nhận xét tùy chỉnh:</label>
                    <textarea id="digital-literacy-comment" rows="2" placeholder="Nhập nhận xét của bạn..."></textarea>
                </div>
            </div>
            
            <!-- Tổng kết -->
            <div class="summary-box">
                <div class="summary-stats">
                    <span class="g-level">Mức đánh giá: <span id="g-level">G1</span></span>
                </div>
                
                <label for="general-comment"><i class="fas fa-edit"></i> NHẬN XÉT CHUNG CỦA GIÁO VIÊN:</label>
                <textarea id="general-comment" rows="3" placeholder="Nhận xét chung về quá trình học tập..."></textarea>
                
                <div class="suggest-container" style="margin-top: 10px;">
                    <label>Gợi ý nhận xét chung:</label>
                    <div class="suggest-options" id="general-suggestions"></div>
                </div>
            </div>
            
            <!-- Nút chức năng -->
            <div class="action-buttons">
                <button class="btn btn-primary" id="reset-btn">
                    <i class="fas fa-redo"></i> Làm mới
                </button>
                <button class="btn btn-success" id="copy-btn">
                    <i class="fas fa-copy"></i> Sao chép
                </button>
                <button class="btn btn-secondary" id="print-btn">
                    <i class="fas fa-print"></i> In phiếu
                </button>
                <button class="btn btn-warning" id="save-template-btn">
                    <i class="fas fa-save"></i> Lưu mẫu
                </button>
                <button class="btn btn-primary" id="export-pdf-btn">
                    <i class="fas fa-file-pdf"></i> Xuất PDF
                </button>
            </div>
        </div>
        
        <!-- Khung xem trước bên phải -->
        <div class="preview-container">
            <div class="preview-title">PHIẾU NHẬN XÉT QUÁ TRÌNH HỌC TẬP</div>
            
            <!-- Thông tin học sinh -->
            <div class="preview-section">
                <div class="student-info">
                    <div>
                        <strong>Họ và tên học sinh:</strong> 
                        <span id="preview-studentName">___________________</span>
                    </div>
                    <div>
                        <strong>Lớp:</strong> 
                        <span id="preview-className">___________________</span>
                    </div>
                    <div>
                        <strong>Giáo viên:</strong> 
                        <span id="preview-teacherName">___________________</span>
                    </div>
                    <div>
                        <strong>SĐT giáo viên:</strong> 
                        <span id="preview-teacherPhone">___________________</span>
                    </div>
                </div>
            </div>
            
            <!-- Bảng đánh giá năng lực -->
            <div class="preview-section">
                <h3 style="color: var(--primary-dark); margin-bottom: 10px;">ĐÁNH GIÁ NĂNG LỰC</h3>
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th width="30%">Năng lực</th>
                            <th width="15%">Mức đánh giá</th>
                            <th>Nhận xét chi tiết</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Grammar</strong></td>
                            <td id="preview-grammar-stars">☆☆☆☆☆</td>
                            <td id="preview-grammar-comment">Chưa có nhận xét</td>
                        </tr>
                        <tr>
                            <td><strong>Vocabulary</strong></td>
                            <td id="preview-vocabulary-stars">☆☆☆☆☆</td>
                            <td id="preview-vocabulary-comment">Chưa có nhận xét</td>
                        </tr>
                        <tr>
                            <td><strong>Communication</strong></td>
                            <td id="preview-communication-stars">☆☆☆☆☆</td>
                            <td id="preview-communication-comment">Chưa có nhận xét</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Bảng đánh giá Global Skills -->
            <div class="preview-section">
                <h3 style="color: var(--primary-dark); margin-bottom: 10px;">ĐÁNH GIÁ GLOBAL SKILLS</h3>
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th width="30%">Kỹ năng</th>
                            <th width="15%">Mức đánh giá</th>
                            <th>Nhận xét chi tiết</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Communication and Collaboration</strong></td>
                            <td id="preview-collaboration-stars">☆☆☆☆☆</td>
                            <td id="preview-collaboration-comment">Chưa có nhận xét</td>
                        </tr>
                        <tr>
                            <td><strong>Critical thinking and Problem solving</strong></td>
                            <td id="preview-critical-thinking-stars">☆☆☆☆☆</td>
                            <td id="preview-critical-thinking-comment">Chưa có nhận xét</td>
                        </tr>
                        <tr>
                            <td><strong>Global awareness and Digital literacy</strong></td>
                            <td id="preview-digital-literacy-stars">☆☆☆☆☆</td>
                            <td id="preview-digital-literacy-comment">Chưa có nhận xét</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Nhận xét chung -->
            <div class="preview-section">
                <h3 style="color: var(--primary-dark); margin-bottom: 10px;">NHẬN XÉT CHUNG CỦA GIÁO VIÊN</h3>
                <div id="preview-general-comment" style="min-height: 70px; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem; line-height: 1.5;">
                    Chưa có nhận xét chung.
                </div>
            </div>
            
            <!-- Chữ ký -->
            <div class="teacher-signature">
                <div><strong>Giáo viên ký tên</strong></div>
                <div style="margin-top: 40px; font-weight: 600; font-size: 1.1rem;">_________________________</div>
                <div style="margin-top: 5px; font-size: 0.9rem;">(Ký và ghi rõ họ tên)</div>
            </div>
        </div>
    </div>
    
    <!-- Toast thông báo -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Thao tác thành công!</span>
    </div>

    <script>
        // ==================== KHO DỮ LIỆU NHẬN XÉT ====================
        // Dữ liệu được chuyển đổi từ sheet DATA trong Excel
        
        // Ngân hàng nhận xét theo mức sao (1-5) - Core Skills
        const commentBankByStars = {
            1: {
                grammar: [
                    "Cần ôn lại kiến thức nền tảng và luyện tập thường xuyên hơn.",
                    "Chưa nắm chắc nội dung đã học; cần thêm thời gian củng cố.",
                    "Thường xuyên mắc lỗi cơ bản; cần kèm sát khi làm bài.",
                    "Khả năng áp dụng kiến thức còn yếu; cần luyện theo hướng dẫn.",
                    "Chưa đạt yêu cầu của khóa; nên bổ sung bài tập ở nhà."
                ],
                vocabulary: [
                    "Cần củng cố vốn từ vựng cơ bản.",
                    "Chưa nhớ được từ vựng đã học; cần ôn tập nhiều hơn.",
                    "Phản xạ với từ vựng còn chậm; cần luyện tập thêm.",
                    "Sử dụng từ vựng chưa chính xác; cần chú ý ngữ cảnh.",
                    "Cần tăng cường học từ vựng mỗi ngày."
                ],
                communication: [
                    "Cần cải thiện sự tập trung và tính kỷ luật trong giờ học.",
                    "Còn ngại tham gia; nên tăng cường hoạt động luyện tập đơn giản.",
                    "Chưa hình thành thói quen tự sửa lỗi; cần nhắc nhở thường xuyên.",
                    "Cần học bổ trợ để theo kịp tiến độ lớp.",
                    "Khuyến nghị ôn tập lại các chủ điểm cơ bản trước khi học nâng cao."
                ],
                collaboration: [
                    "Còn ngại giao tiếp và hợp tác với bạn trong nhóm.",
                    "Cần học cách lắng nghe và tôn trọng ý kiến của người khác.",
                    "Chưa chủ động tham gia vào các hoạt động nhóm.",
                    "Cần rèn luyện kỹ năng làm việc nhóm cơ bản.",
                    "Chưa biết cách phối hợp hiệu quả với các thành viên."
                ],
                criticalThinking: [
                    "Còn gặp khó khăn trong việc phân tích và giải quyết vấn đề.",
                    "Chưa phát triển tư duy phản biện; cần hướng dẫn từng bước.",
                    "Thường bỏ qua các chi tiết quan trọng khi giải quyết vấn đề.",
                    "Cần luyện tập thêm các bài tập tư duy logic đơn giản.",
                    "Chưa biết cách đặt câu hỏi để làm rõ vấn đề."
                ],
                digitalLiteracy: [
                    "Còn hạn chế trong việc sử dụng công nghệ để học tập.",
                    "Chưa nhận thức được tầm quan trọng của kỹ năng số trong thời đại hiện nay.",
                    "Cần hướng dẫn cụ thể khi sử dụng các công cụ học tập trực tuyến.",
                    "Chưa biết cách tìm kiếm và đánh giá thông tin trên internet.",
                    "Cần nâng cao nhận thức về văn hóa toàn cầu và công dân số."
                ]
            },
            2: {
                grammar: [
                    "Có cố gắng nhưng kiến thức chưa vững; cần luyện thêm.",
                    "Nắm được một phần nội dung nhưng độ chính xác chưa ổn định.",
                    "Còn phụ thuộc vào gợi ý; cần tăng tính chủ động.",
                    "Thỉnh thoảng mắc lỗi cơ bản; cần ôn lại các điểm trọng tâm.",
                    "Tiến bộ chậm; nên luyện tập đều đặn ở nhà."
                ],
                vocabulary: [
                    "Đã hiểu bài nhưng vận dụng chưa linh hoạt.",
                    "Cần luyện thêm dạng bài quen thuộc để giảm sai sót.",
                    "Tham gia tương đối; nên tích cực phát biểu hơn.",
                    "Cần tăng tốc độ làm bài và độ tập trung.",
                    "Khuyến nghị làm thêm bài tập bổ trợ theo tuần."
                ],
                communication: [
                    "Cần luyện thêm dạng bài quen thuộc để giảm sai sót.",
                    "Tham gia tương đối; nên tích cực phát biểu hơn.",
                    "Cần tăng tốc độ làm bài và độ tập trung.",
                    "Khuyến nghị làm thêm bài tập bổ trợ theo tuần.",
                    "Cần cải thiện khả năng phản xạ trong giao tiếp."
                ],
                collaboration: [
                    "Đã bắt đầu tham gia vào hoạt động nhóm nhưng còn rụt rè.",
                    "Cần mạnh dạn hơn trong việc chia sẻ ý kiến cá nhân.",
                    "Đã có tiến bộ trong việc lắng nghe người khác.",
                    "Cần chủ động hơn trong việc phân công công việc nhóm.",
                    "Đã hiểu được tầm quan trọng của làm việc nhóm."
                ],
                criticalThinking: [
                    "Đã bắt đầu biết đặt câu hỏi về vấn đề được học.",
                    "Có tiến bộ trong việc nhận diện vấn đề cơ bản.",
                    "Cần luyện tập thêm để phát triển tư duy phân tích.",
                    "Đã có thể giải quyết các vấn đề đơn giản khi được hướng dẫn.",
                    "Cần tự tin hơn trong việc đưa ra giải pháp."
                ],
                digitalLiteracy: [
                    "Đã biết sử dụng cơ bản một số công cụ học tập trực tuyến.",
                    "Có nhận thức ban đầu về tầm quan trọng của kỹ năng số.",
                    "Cần luyện tập thêm để thành thạo các công cụ công nghệ.",
                    "Đã bắt đầu tìm kiếm thông tin trên internet dưới sự hướng dẫn.",
                    "Cần nâng cao hiểu biết về văn hóa các nước."
                ]
            },
            3: {
                grammar: [
                    "Đáp ứng yêu cầu cơ bản của khóa học.",
                    "Nắm được kiến thức trọng tâm và áp dụng ở mức ổn định.",
                    "Có tiến bộ đều; cần luyện thêm để nâng độ chính xác.",
                    "Hoàn thành tốt bài tập mức trung bình.",
                    "Vận dụng được kiến thức trong đa số tình huống quen thuộc."
                ],
                vocabulary: [
                    "Cần cải thiện một số lỗi nhỏ để đạt kết quả cao hơn.",
                    "Tham gia học tập tương đối tích cực.",
                    "Đã có nền tảng tốt để tiếp tục học lên.",
                    "Cần duy trì nhịp độ học và ôn tập hiện tại.",
                    "Khuyến khích luyện thêm để tăng sự tự tin."
                ],
                communication: [
                    "Tham gia học tập tương đối tích cực.",
                    "Đã có nền tảng tốt để tiếp tục học lên.",
                    "Cần duy trì nhịp độ học và ôn tập hiện tại.",
                    "Khuyến khích luyện thêm để tăng sự tự tin.",
                    "Giao tiếp ở mức cơ bản; cần luyện thêm để tự tin hơn."
                ],
                collaboration: [
                    "Tham gia tích cực vào các hoạt động nhóm.",
                    "Biết lắng nghe và tôn trọng ý kiến của các thành viên.",
                    "Có khả năng phối hợp khá tốt trong nhóm nhỏ.",
                    "Đôi khi còn ngại đưa ra ý kiến trước đám đông.",
                    "Có tinh thần hợp tác và hỗ trợ bạn bè."
                ],
                criticalThinking: [
                    "Có khả năng phân tích vấn đề ở mức độ trung bình.",
                    "Biết đặt câu hỏi để làm rõ thông tin khi cần thiết.",
                    "Có thể đề xuất giải pháp cho các vấn đề quen thuộc.",
                    "Cần luyện tập thêm để phát triển tư duy sáng tạo.",
                    "Đã có tư duy phản biện ở mức cơ bản."
                ],
                digitalLiteracy: [
                    "Sử dụng thành thạo các công cụ học tập trực tuyến cơ bản.",
                    "Có hiểu biết về văn hóa toàn cầu và công dân số.",
                    "Biết cách tìm kiếm và đánh giá thông tin trên internet.",
                    "Có khả năng sử dụng công nghệ để hỗ trợ học tập.",
                    "Nhận thức được tầm quan trọng của kỹ năng số trong thời đại 4.0."
                ]
            },
            4: {
                grammar: [
                    "Nắm vững hầu hết nội dung và vận dụng khá linh hoạt.",
                    "Tiến bộ rõ rệt; làm bài tốt và ổn định.",
                    "Thái độ học tập tích cực, chủ động trong giờ học.",
                    "Áp dụng kiến thức hiệu quả, ít mắc lỗi.",
                    "Có khả năng tự sửa lỗi khi được góp ý."
                ],
                vocabulary: [
                    "Thực hiện tốt các dạng bài tập của khóa.",
                    "Giao tiếp tự nhiên hơn; phản xạ tốt trong hoạt động lớp.",
                    "Có nền tảng tốt để học nâng cao.",
                    "Thường hoàn thành bài tập đúng hạn và chất lượng.",
                    "Kết quả học tập tốt so với mặt bằng chung."
                ],
                communication: [
                    "Giao tiếp tự nhiên hơn; phản xạ tốt trong hoạt động lớp.",
                    "Có nền tảng tốt để học nâng cao.",
                    "Thường hoàn thành bài tập đúng hạn và chất lượng.",
                    "Kết quả học tập tốt so với mặt bằng chung.",
                    "Tự tin hơn trong giao tiếp; phản xạ nhanh."
                ],
                collaboration: [
                    "Rất tích cực trong các hoạt động nhóm và hợp tác.",
                    "Có khả năng lãnh đạo nhóm nhỏ hiệu quả.",
                    "Biết cách phân công công việc và phối hợp nhịp nhàng.",
                    "Luôn hỗ trợ và khuyến khích các thành viên trong nhóm.",
                    "Giao tiếp hiệu quả để giải quyết mâu thuẫn trong nhóm."
                ],
                criticalThinking: [
                    "Có tư duy phân tích tốt, biết đặt câu hỏi sâu.",
                    "Có khả năng giải quyết vấn đề một cách sáng tạo.",
                    "Biết đánh giá và lựa chọn giải pháp tối ưu.",
                    "Có tư duy phản biện tốt, không chấp nhận thông tin một chiều.",
                    "Biết cách phân tích vấn đề từ nhiều góc độ khác nhau."
                ],
                digitalLiteracy: [
                    "Sử dụng thành thạo công nghệ để học tập và nghiên cứu.",
                    "Có hiểu biết sâu về văn hóa toàn cầu và xu hướng số.",
                    "Biết cách đánh giá và chọn lọc thông tin trên internet.",
                    "Có khả năng sử dụng các công cụ số để sáng tạo nội dung.",
                    "Nhận thức rõ về trách nhiệm công dân số và an toàn thông tin."
                ]
            },
            5: {
                grammar: [
                    "Nắm vững và vận dụng xuất sắc kiến thức đã học.",
                    "Tiến bộ vượt bậc; phản xạ nhanh và chính xác.",
                    "Rất chủ động, tích cực và có tinh thần học tập tốt.",
                    "Áp dụng linh hoạt; hiếm khi mắc lỗi.",
                    "Thể hiện tư duy ngôn ngữ tốt và tự tin trong lớp."
                ],
                vocabulary: [
                    "Luôn hoàn thành bài tập với chất lượng cao.",
                    "Có khả năng hỗ trợ bạn khác và làm việc nhóm hiệu quả.",
                    "Giao tiếp tự nhiên, diễn đạt rõ ràng và mạch lạc.",
                    "Sẵn sàng học lên trình độ cao hơn.",
                    "Kết quả học tập xuất sắc, vượt yêu cầu khóa học."
                ],
                communication: [
                    "Có khả năng hỗ trợ bạn khác và làm việc nhóm hiệu quả.",
                    "Giao tiếp tự nhiên, diễn đạt rõ ràng và mạch lạc.",
                    "Sẵn sàng học lên trình độ cao hơn.",
                    "Kết quả học tập xuất sắc, vượt yêu cầu khóa học.",
                    "Giao tiếp xuất sắc, tự tin và lưu loát."
                ],
                collaboration: [
                    "Xuất sắc trong việc hợp tác và làm việc nhóm.",
                    "Có khả năng lãnh đạo và điều phối nhóm hiệu quả.",
                    "Luôn tạo động lực và hỗ trợ các thành viên phát triển.",
                    "Giải quyết mâu thuẫn nhóm một cách khéo léo và hiệu quả.",
                    "Là cầu nối quan trọng trong giao tiếp giữa các thành viên."
                ],
                criticalThinking: [
                    "Có tư duy phản biện xuất sắc, luôn đặt câu hỏi sâu sắc.",
                    "Giải quyết vấn đề một cách sáng tạo và hiệu quả.",
                    "Có khả năng phân tích đa chiều và đề xuất giải pháp tối ưu.",
                    "Luôn tìm kiếm cách tiếp cận mới cho các vấn đề phức tạp.",
                    "Có tư duy hệ thống tốt, nhìn nhận vấn đề toàn diện."
                ],
                digitalLiteracy: [
                    "Thành thạo trong việc sử dụng công nghệ để học tập và sáng tạo.",
                    "Có hiểu biết sâu rộng về văn hóa toàn cầu và công nghệ số.",
                    "Có khả năng đánh giá, tổng hợp và sáng tạo nội dung số.",
                    "Nhận thức đầy đủ về trách nhiệm và đạo đức công dân số.",
                    "Có thể hướng dẫn người khác sử dụng công nghệ hiệu quả."
                ]
            }
        };
        
        // Nhận xét theo mức tổng quát G1-G4
        const generalLevelComments = {
            "G1": [
                "Cần củng cố nền tảng và ôn tập đều đặn hằng tuần.",
                "Nên luyện thêm bài tập cơ bản để tăng độ chính xác.",
                "Cần cải thiện sự tập trung và chủ động trong giờ học.",
                "Khuyến nghị phụ huynh hỗ trợ lịch ôn tập tại nhà.",
                "Nên luyện nghe – nói ở mức đơn giản mỗi ngày.",
                "Cần tăng thói quen tự kiểm tra và sửa lỗi.",
                "Nên học bổ trợ để theo kịp tiến độ chương trình.",
                "Cần rèn kỹ năng làm bài theo hướng dẫn từng bước.",
                "Khuyến khích đặt mục tiêu nhỏ và theo dõi tiến bộ.",
                "Nếu có thể, nên học thêm buổi phụ đạo/ôn tập."
            ],
            "G2": [
                "Học sinh có tiến bộ, cần luyện thêm để ổn định kết quả.",
                "Nên tăng cường ôn tập để giảm lỗi ở các chủ điểm quen thuộc.",
                "Khuyến khích chủ động phát biểu và tham gia hoạt động lớp.",
                "Cần duy trì lịch luyện tập đều đặn ngoài giờ.",
                "Nên luyện thêm bài tập theo chủ đề để vận dụng tốt hơn.",
                "Khuyến khích tự sửa lỗi và ghi chú lỗi thường gặp.",
                "Cần cải thiện tốc độ phản xạ và sự tự tin.",
                "Có tiềm năng; cần kiên trì để bứt phá.",
                "Nên đặt mục tiêu tuần và tự kiểm tra cuối tuần.",
                "Tiếp tục cố gắng để đạt mức cao hơn."
            ],
            "G3": [
                "Học sinh học tốt và có thái độ tích cực.",
                "Nắm chắc nội dung; cần luyện thêm để tăng độ trôi chảy.",
                "Khuyến khích mở rộng vốn từ theo chủ đề đã học.",
                "Nên luyện thêm để tăng độ chính xác ở các chi tiết nhỏ.",
                "Tiếp tục duy trì thói quen ôn tập đều đặn.",
                "Có khả năng tự học tốt; nên làm thêm bài nâng cao vừa sức.",
                "Khuyến khích tham gia nhiều hoạt động giao tiếp hơn.",
                "Kết quả ổn định; tiếp tục phát huy.",
                "Nên luyện nghe – nói thường xuyên để tăng phản xạ.",
                "Sẵn sàng học lên cấp độ tiếp theo."
            ],
            "G4": [
                "Học sinh đạt kết quả xuất sắc và rất chủ động.",
                "Vận dụng linh hoạt; phản xạ tốt trong nhiều tình huống.",
                "Có thái độ học tập rất tốt và tinh thần tự học cao.",
                "Khuyến khích tham gia thêm hoạt động nâng cao để phát triển thêm.",
                "Nên mở rộng kỹ năng diễn đạt và thuyết trình.",
                "Tiếp tục phát huy để đạt thành tích cao hơn nữa.",
                "Có nền tảng vững; phù hợp học nội dung nâng cao.",
                "Khả năng giao tiếp tốt; nên luyện thêm để tăng độ tự nhiên.",
                "Thể hiện sự tiến bộ vượt bậc trong khóa học.",
                "Sẵn sàng cho khóa tiếp theo ở trình độ cao hơn."
            ]
        };
        
        // ==================== BIẾN TOÀN CỤC ====================
        let ratings = {
            grammar: 0,
            vocabulary: 0,
            communication: 0,
            collaboration: 0,
            criticalThinking: 0,
            digitalLiteracy: 0
        };
        
        let selectedComments = {
            grammar: "",
            vocabulary: "",
            communication: "",
            collaboration: "",
            criticalThinking: "",
            digitalLiteracy: "",
            general: ""
        };
        
        // ==================== HÀM TIỆN ÍCH ====================
        
        // Hiển thị thông báo toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            
            if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'warning') {
                toast.classList.add('warning');
            }
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.remove('error', 'warning');
            }, 3000);
        }
        
        // Tạo chuỗi sao từ số (5 → ★★★★★)
        function getStarsString(rating) {
            if (rating < 1 || rating > 5) return '☆☆☆☆☆';
            return '★'.repeat(rating) + '☆'.repeat(5 - rating);
        }
        
        // Tính tổng số sao và xác định mức G
        function calculateTotalAndLevel() {
            const total = Object.values(ratings).reduce((sum, rating) => sum + rating, 0);
            
            // Xác định mức G dựa trên tổng số sao (có 6 mục đánh giá)
            let gLevel;
            if (total <= 10) {
                gLevel = "G1";
            } else if (total <= 18) {
                gLevel = "G2";
            } else if (total <= 24) {
                gLevel = "G3";
            } else {
                gLevel = "G4";
            }
            
            return { total, gLevel };
        }
        
        // Cập nhật tổng số sao và mức G
        function updateSummary() {
            const { gLevel } = calculateTotalAndLevel();
            
            // Cập nhật mức G
            document.getElementById('g-level').textContent = gLevel;
            document.getElementById('preview-g-level').textContent = gLevel;
            
            // Cập nhật thanh tiến độ
            updateProgressBar();
        }
        
        // Cập nhật thanh tiến độ
        function updateProgressBar() {
            const totalFilled = Object.values(ratings).filter(r => r > 0).length;
            const totalItems = Object.keys(ratings).length;
            const progressPercent = (totalFilled / totalItems) * 100;
            
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
        }
        
        // Tải gợi ý nhận xét cho năng lực cụ thể
        function loadSuggestionsForCompetency(competency, rating) {
            const suggestionsContainer = document.getElementById(`${competency}-suggestions`);
            suggestionsContainer.innerHTML = '';
            
            if (!rating || rating < 1) {
                suggestionsContainer.innerHTML = '<div class="suggest-option">Vui lòng chọn mức sao trước</div>';
                return;
            }
            
            const comments = commentBankByStars[rating][competency] || [];
            
            if (comments.length === 0) {
                suggestionsContainer.innerHTML = '<div class="suggest-option">Không có gợi ý cho mức này</div>';
                return;
            }
            
            comments.forEach((comment, index) => {
                const option = document.createElement('div');
                option.className = 'suggest-option';
                option.textContent = comment;
                option.dataset.index = index;
                
                option.addEventListener('click', function() {
                    // Xóa selection cũ
                    document.querySelectorAll(`#${competency}-suggestions .suggest-option`).forEach(opt => {
                        opt.style.backgroundColor = '';
                        opt.style.color = '';
                        opt.style.borderColor = '';
                    });
                    
                    // Đánh dấu selection mới
                    this.style.backgroundColor = 'var(--primary-color)';
                    this.style.color = 'white';
                    this.style.borderColor = 'var(--primary-color)';
                    
                    // Lưu nhận xét đã chọn
                    selectedComments[competency] = comment;
                    
                    // Cập nhật textarea
                    const textareaId = competency === 'criticalThinking' ? 'critical-thinking-comment' : 
                                      competency === 'digitalLiteracy' ? 'digital-literacy-comment' : 
                                      `${competency}-comment`;
                    document.getElementById(textareaId).value = comment;
                    
                    // Cập nhật preview
                    updatePreview();
                });
                
                suggestionsContainer.appendChild(option);
            });
        }
        
        // Tải gợi ý nhận xét chung
        function loadGeneralSuggestions() {
            const suggestionsContainer = document.getElementById('general-suggestions');
            const { gLevel } = calculateTotalAndLevel();
            
            suggestionsContainer.innerHTML = '';
            
            const comments = generalLevelComments[gLevel] || [];
            
            if (comments.length === 0) {
                suggestionsContainer.innerHTML = '<div class="suggest-option">Không có gợi ý cho mức này</div>';
                return;
            }
            
            comments.forEach((comment, index) => {
                const option = document.createElement('div');
                option.className = 'suggest-option';
                option.textContent = comment;
                option.dataset.index = index;
                
                option.addEventListener('click', function() {
                    // Xóa selection cũ
                    document.querySelectorAll('#general-suggestions .suggest-option').forEach(opt => {
                        opt.style.backgroundColor = '';
                        opt.style.color = '';
                        opt.style.borderColor = '';
                    });
                    
                    // Đánh dấu selection mới
                    this.style.backgroundColor = 'var(--primary-color)';
                    this.style.color = 'white';
                    this.style.borderColor = 'var(--primary-color)';
                    
                    // Lưu nhận xét đã chọn
                    selectedComments.general = comment;
                    
                    // Cập nhật textarea
                    document.getElementById('general-comment').value = comment;
                    
                    // Cập nhật preview
                    updatePreview();
                });
                
                suggestionsContainer.appendChild(option);
            });
        }
        
        // Cập nhật preview
        function updatePreview() {
            // Thông tin học sinh
            document.getElementById('preview-studentName').textContent = 
                document.getElementById('studentName').value || '___________________';
            document.getElementById('preview-className').textContent = 
                document.getElementById('className').value || '___________________';
            document.getElementById('preview-teacherName').textContent = 
                document.getElementById('teacherName').value || '___________________';
            document.getElementById('preview-teacherPhone').textContent = 
                document.getElementById('teacherPhone').value || '___________________';
            
            // Năng lực
            document.getElementById('preview-grammar-stars').textContent = getStarsString(ratings.grammar);
            document.getElementById('preview-vocabulary-stars').textContent = getStarsString(ratings.vocabulary);
            document.getElementById('preview-communication-stars').textContent = getStarsString(ratings.communication);
            
            document.getElementById('preview-grammar-comment').textContent = 
                document.getElementById('grammar-comment').value || 'Chưa có nhận xét';
            document.getElementById('preview-vocabulary-comment').textContent = 
                document.getElementById('vocabulary-comment').value || 'Chưa có nhận xét';
            document.getElementById('preview-communication-comment').textContent = 
                document.getElementById('communication-comment').value || 'Chưa có nhận xét';
            
            // Global Skills
            document.getElementById('preview-collaboration-stars').textContent = getStarsString(ratings.collaboration);
            document.getElementById('preview-critical-thinking-stars').textContent = getStarsString(ratings.criticalThinking);
            document.getElementById('preview-digital-literacy-stars').textContent = getStarsString(ratings.digitalLiteracy);
            
            document.getElementById('preview-collaboration-comment').textContent = 
                document.getElementById('collaboration-comment').value || 'Chưa có nhận xét';
            document.getElementById('preview-critical-thinking-comment').textContent = 
                document.getElementById('critical-thinking-comment').value || 'Chưa có nhận xét';
            document.getElementById('preview-digital-literacy-comment').textContent = 
                document.getElementById('digital-literacy-comment').value || 'Chưa có nhận xét';
            
            // Nhận xét chung
            document.getElementById('preview-general-comment').textContent = 
                document.getElementById('general-comment').value || 'Chưa có nhận xét chung.';
            
            // Cập nhật hiển thị sao trong form
            document.getElementById('grammar-star-display').textContent = getStarsString(ratings.grammar);
            document.getElementById('vocabulary-star-display').textContent = getStarsString(ratings.vocabulary);
            document.getElementById('communication-star-display').textContent = getStarsString(ratings.communication);
            document.getElementById('collaboration-star-display').textContent = getStarsString(ratings.collaboration);
            document.getElementById('critical-thinking-star-display').textContent = getStarsString(ratings.criticalThinking);
            document.getElementById('digital-literacy-star-display').textContent = getStarsString(ratings.digitalLiteracy);
            
            // Tổng kết
            updateSummary();
        }
        
        // Sao chép nội dung phiếu
        function copyToClipboard() {
            const studentName = document.getElementById('studentName').value || '___________________';
            const className = document.getElementById('className').value || '___________________';
            const teacherName = document.getElementById('teacherName').value || '___________________';
            
            const grammarStars = getStarsString(ratings.grammar);
            const vocabularyStars = getStarsString(ratings.vocabulary);
            const communicationStars = getStarsString(ratings.communication);
            const collaborationStars = getStarsString(ratings.collaboration);
            const criticalThinkingStars = getStarsString(ratings.criticalThinking);
            const digitalLiteracyStars = getStarsString(ratings.digitalLiteracy);
            
            const grammarComment = document.getElementById('grammar-comment').value || 'Chưa có nhận xét';
            const vocabularyComment = document.getElementById('vocabulary-comment').value || 'Chưa có nhận xét';
            const communicationComment = document.getElementById('communication-comment').value || 'Chưa có nhận xét';
            const collaborationComment = document.getElementById('collaboration-comment').value || 'Chưa có nhận xét';
            const criticalThinkingComment = document.getElementById('critical-thinking-comment').value || 'Chưa có nhận xét';
            const digitalLiteracyComment = document.getElementById('digital-literacy-comment').value || 'Chưa có nhận xét';
            
            const generalComment = document.getElementById('general-comment').value || 'Chưa có nhận xét chung.';
            
            const { gLevel } = calculateTotalAndLevel();
            
            const text = `PHIẾU NHẬN XÉT QUÁ TRÌNH HỌC TẬP

Họ và tên học sinh: ${studentName}
Lớp: ${className}
Giáo viên: ${teacherName}

ĐÁNH GIÁ NĂNG LỰC
1. Grammar: ${grammarStars}
   ${grammarComment}

2. Vocabulary: ${vocabularyStars}
   ${vocabularyComment}

3. Communication: ${communicationStars}
   ${communicationComment}

ĐÁNH GIÁ GLOBAL SKILLS
4. Communication and Collaboration: ${collaborationStars}
   ${collaborationComment}

5. Critical thinking and Problem solving: ${criticalThinkingStars}
   ${criticalThinkingComment}

6. Global awareness and Digital literacy: ${digitalLiteracyStars}
   ${digitalLiteracyComment}

Mức đánh giá tổng quát: ${gLevel}

NHẬN XÉT CHUNG CỦA GIÁO VIÊN:
${generalComment}

Giáo viên ký tên:
_________________________`;
            
            navigator.clipboard.writeText(text)
                .then(() => {
                    showToast('Đã sao chép nội dung phiếu nhận xét!');
                })
                .catch(err => {
                    console.error('Lỗi sao chép: ', err);
                    showToast('Lỗi sao chép nội dung!', 'error');
                });
        }
        
        // Xuất file PDF (mô phỏng)
        function exportToPDF() {
            // Trong môi trường thực tế, cần sử dụng thư viện như jsPDF
            // Ở đây chúng ta sẽ tạo một cửa sổ in tối ưu hóa
            showToast('Đang chuẩn bị phiếu để in...', 'warning');
            
            // Tạo một bản sao tối ưu hóa cho in ấn
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Phiếu Nhận Xét Học Sinh</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; margin: 0; padding: 20px; font-size: 12pt; }
                        .header { text-align: center; font-size: 16pt; font-weight: bold; margin-bottom: 20px; }
                        .student-info { margin-bottom: 20px; }
                        .student-info div { margin-bottom: 5px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
                        th { background-color: #f0f0f0; padding: 8px; border: 1px solid #000; text-align: left; }
                        td { padding: 8px; border: 1px solid #000; vertical-align: top; }
                        .signature { text-align: right; margin-top: 40px; }
                        @page { margin: 0.5in; }
                    </style>
                </head>
                <body>
                    <div class="header">PHIẾU NHẬN XÉT QUÁ TRÌNH HỌC TẬP</div>
                    
                    <div class="student-info">
                        <div><strong>Họ và tên học sinh:</strong> ${document.getElementById('studentName').value || '___________________'}</div>
                        <div><strong>Lớp:</strong> ${document.getElementById('className').value || '___________________'}</div>
                        <div><strong>Giáo viên:</strong> ${document.getElementById('teacherName').value || '___________________'}</div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Năng lực/Kỹ năng</th>
                                <th>Mức đánh giá</th>
                                <th>Nhận xét chi tiết</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Grammar</strong></td>
                                <td>${getStarsString(ratings.grammar)}</td>
                                <td>${document.getElementById('grammar-comment').value || 'Chưa có nhận xét'}</td>
                            </tr>
                            <tr>
                                <td><strong>Vocabulary</strong></td>
                                <td>${getStarsString(ratings.vocabulary)}</td>
                                <td>${document.getElementById('vocabulary-comment').value || 'Chưa có nhận xét'}</td>
                            </tr>
                            <tr>
                                <td><strong>Communication</strong></td>
                                <td>${getStarsString(ratings.communication)}</td>
                                <td>${document.getElementById('communication-comment').value || 'Chưa có nhận xét'}</td>
                            </tr>
                            <tr>
                                <td><strong>Communication and Collaboration</strong></td>
                                <td>${getStarsString(ratings.collaboration)}</td>
                                <td>${document.getElementById('collaboration-comment').value || 'Chưa có nhận xét'}</td>
                            </tr>
                            <tr>
                                <td><strong>Critical thinking and Problem solving</strong></td>
                                <td>${getStarsString(ratings.criticalThinking)}</td>
                                <td>${document.getElementById('critical-thinking-comment').value || 'Chưa có nhận xét'}</td>
                            </tr>
                            <tr>
                                <td><strong>Global awareness and Digital literacy</strong></td>
                                <td>${getStarsString(ratings.digitalLiteracy)}</td>
                                <td>${document.getElementById('digital-literacy-comment').value || 'Chưa có nhận xét'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div><strong>NHẬN XÉT CHUNG:</strong></div>
                    <div style="margin: 10px 0 20px 0; min-height: 60px; border: 1px solid #ccc; padding: 10px;">
                        ${document.getElementById('general-comment').value || 'Chưa có nhận xét chung.'}
                    </div>
                    
                    <div class="signature">
                        <div><strong>Mức đánh giá: ${document.getElementById('g-level').textContent}</strong></div>
                        <div style="margin-top: 40px;">_________________________</div>
                        <div><strong>Giáo viên ký tên</strong></div>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            // Cho phép người dùng xem trước trước khi in
            setTimeout(() => {
                printWindow.focus();
                showToast('Phiếu đã sẵn sàng để in. Nhấn Ctrl+P để in.', 'success');
            }, 500);
        }
        
        // Lưu mẫu nhận xét
        function saveTemplate() {
            const studentName = document.getElementById('studentName').value;
            if (!studentName) {
                showToast('Vui lòng nhập tên học sinh trước khi lưu mẫu', 'warning');
                return;
            }
            
            const template = {
                studentName: studentName,
                className: document.getElementById('className').value,
                ratings: {...ratings},
                comments: {
                    grammar: document.getElementById('grammar-comment').value,
                    vocabulary: document.getElementById('vocabulary-comment').value,
                    communication: document.getElementById('communication-comment').value,
                    collaboration: document.getElementById('collaboration-comment').value,
                    criticalThinking: document.getElementById('critical-thinking-comment').value,
                    digitalLiteracy: document.getElementById('digital-literacy-comment').value,
                    general: document.getElementById('general-comment').value
                },
                timestamp: new Date().toLocaleString('vi-VN')
            };
            
            // Lưu vào localStorage
            const templates = JSON.parse(localStorage.getItem('commentTemplates') || '[]');
            templates.push(template);
            localStorage.setItem('commentTemplates', JSON.stringify(templates));
            
            showToast(`Đã lưu mẫu nhận xét cho ${studentName}`, 'success');
        }
        
        // Tải mẫu nhanh
        function loadQuickTemplate(templateType) {
            const templates = {
                excellent: {
                    ratings: { grammar: 5, vocabulary: 5, communication: 5, collaboration: 5, criticalThinking: 5, digitalLiteracy: 5 },
                    comments: {
                        grammar: "Nắm vững và vận dụng xuất sắc kiến thức đã học.",
                        vocabulary: "Tiến bộ vượt bậc; phản xạ nhanh và chính xác.",
                        communication: "Giao tiếp xuất sắc, tự tin và lưu loát.",
                        collaboration: "Xuất sắc trong việc hợp tác và làm việc nhóm.",
                        criticalThinking: "Có tư duy phản biện xuất sắc, luôn đặt câu hỏi sâu sắc.",
                        digitalLiteracy: "Thành thạo trong việc sử dụng công nghệ để học tập và sáng tạo.",
                        general: "Học sinh đạt kết quả xuất sắc và rất chủ động. Sẵn sàng cho khóa tiếp theo ở trình độ cao hơn."
                    }
                },
                good: {
                    ratings: { grammar: 4, vocabulary: 4, communication: 4, collaboration: 4, criticalThinking: 4, digitalLiteracy: 4 },
                    comments: {
                        grammar: "Nắm vững hầu hết nội dung và vận dụng khá linh hoạt.",
                        vocabulary: "Tiến bộ rõ rệt; làm bài tốt và ổn định.",
                        communication: "Giao tiếp tự nhiên hơn; phản xạ tốt trong hoạt động lớp.",
                        collaboration: "Rất tích cực trong các hoạt động nhóm và hợp tác.",
                        criticalThinking: "Có tư duy phân tích tốt, biết đặt câu hỏi sâu.",
                        digitalLiteracy: "Sử dụng thành thạo công nghệ để học tập và nghiên cứu.",
                        general: "Học sinh học tốt và có thái độ tích cực. Sẵn sàng học lên cấp độ tiếp theo."
                    }
                },
                average: {
                    ratings: { grammar: 3, vocabulary: 3, communication: 3, collaboration: 3, criticalThinking: 3, digitalLiteracy: 3 },
                    comments: {
                        grammar: "Đáp ứng yêu cầu cơ bản của khóa học.",
                        vocabulary: "Nắm được kiến thức trọng tâm và áp dụng ở mức ổn định.",
                        communication: "Tham gia học tập tương đối tích cực.",
                        collaboration: "Tham gia tích cực vào các hoạt động nhóm.",
                        criticalThinking: "Có khả năng phân tích vấn đề ở mức độ trung bình.",
                        digitalLiteracy: "Sử dụng thành thạo các công cụ học tập trực tuyến cơ bản.",
                        general: "Học sinh có tiến bộ, cần luyện thêm để ổn định kết quả. Tiếp tục cố gắng để đạt mức cao hơn."
                    }
                },
                "needs-improvement": {
                    ratings: { grammar: 2, vocabulary: 2, communication: 2, collaboration: 2, criticalThinking: 2, digitalLiteracy: 2 },
                    comments: {
                        grammar: "Có cố gắng nhưng kiến thức chưa vững; cần luyện thêm.",
                        vocabulary: "Đã hiểu bài nhưng vận dụng chưa linh hoạt.",
                        communication: "Cần luyện thêm dạng bài quen thuộc để giảm sai sót.",
                        collaboration: "Đã bắt đầu tham gia vào hoạt động nhóm nhưng còn rụt rè.",
                        criticalThinking: "Đã bắt đầu biết đặt câu hỏi về vấn đề được học.",
                        digitalLiteracy: "Đã biết sử dụng cơ bản một số công cụ học tập trực tuyến.",
                        general: "Cần củng cố nền tảng và ôn tập đều đặn hằng tuần. Khuyến nghị phụ huynh hỗ trợ lịch ôn tập tại nhà."
                    }
                }
            };
            
            const template = templates[templateType];
            if (!template) return;
            
            // Áp dụng ratings
            ratings = {...template.ratings};
            
            // Cập nhật sao
            Object.keys(ratings).forEach(competency => {
                const stars = document.querySelectorAll(`[data-competency="${competency}"] .star`);
                const rating = ratings[competency];
                
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.classList.add('active');
                    } else {
                        star.classList.remove('active');
                    }
                });
                
                // Tải gợi ý cho mức sao này
                loadSuggestionsForCompetency(competency, rating);
            });
            
            // Áp dụng comments
            Object.keys(template.comments).forEach(key => {
                const textareaId = key === 'criticalThinking' ? 'critical-thinking-comment' : 
                                  key === 'digitalLiteracy' ? 'digital-literacy-comment' : 
                                  key === 'general' ? 'general-comment' : 
                                  `${key}-comment`;
                document.getElementById(textareaId).value = template.comments[key];
            });
            
            // Tải gợi ý chung
            loadGeneralSuggestions();
            
            // Cập nhật preview
            updatePreview();
            
            showToast(`Đã tải mẫu "${templateType === 'excellent' ? 'Xuất sắc' : templateType === 'good' ? 'Khá' : templateType === 'average' ? 'Trung bình' : 'Cần cải thiện'}"`, 'success');
        }
        
        // Reset form
        function resetForm() {
            // Reset input fields
            document.getElementById('studentName').value = '';
            document.getElementById('className').value = '';
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherPhone').value = '';
            
            // Reset ratings
            ratings = {
                grammar: 0,
                vocabulary: 0,
                communication: 0,
                collaboration: 0,
                criticalThinking: 0,
                digitalLiteracy: 0
            };
            
            // Reset star displays
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('active');
            });
            
            // Reset suggestions
            const competencies = ['grammar', 'vocabulary', 'communication', 'collaboration', 'criticalThinking', 'digitalLiteracy'];
            competencies.forEach(competency => {
                document.getElementById(`${competency}-suggestions`).innerHTML = '<div class="suggest-option">Vui lòng chọn mức sao trước</div>';
            });
            
            document.getElementById('general-suggestions').innerHTML = '<div class="suggest-option">Vui lòng đánh giá các mục trước</div>';
            
            // Reset comments
            document.getElementById('grammar-comment').value = '';
            document.getElementById('vocabulary-comment').value = '';
            document.getElementById('communication-comment').value = '';
            document.getElementById('collaboration-comment').value = '';
            document.getElementById('critical-thinking-comment').value = '';
            document.getElementById('digital-literacy-comment').value = '';
            document.getElementById('general-comment').value = '';
            
            // Ẩn các phần tử custom comment
            document.querySelectorAll('.custom-comment-container').forEach(container => {
                container.classList.remove('show');
            });
            
            // Reset selected comments
            selectedComments = {
                grammar: "",
                vocabulary: "",
                communication: "",
                collaboration: "",
                criticalThinking: "",
                digitalLiteracy: "",
                general: ""
            };
            
            // Update preview
            updatePreview();
            
            showToast('Đã làm mới phiếu nhận xét!');
        }
        
        // ==================== SỰ KIỆN DOM ====================
        
        // Khởi tạo khi DOM sẵn sàng
        document.addEventListener('DOMContentLoaded', function() {
            // Xử lý sự kiện click sao
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const competency = this.closest('.star-rating').dataset.competency;
                    const value = parseInt(this.dataset.value);
                    
                    // Cập nhật rating
                    ratings[competency] = value;
                    
                    // Cập nhật hiển thị sao cho năng lực này
                    const stars = this.parentElement.querySelectorAll('.star');
                    stars.forEach((s, index) => {
                        if (index < value) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    
                    // Tải gợi ý cho mức sao này
                    loadSuggestionsForCompetency(competency, value);
                    
                    // Cập nhật preview
                    updatePreview();
                });
            });
            
            // Xử lý sự kiện nút thêm nhận xét tùy chỉnh
            document.querySelectorAll('.suggest-btn[data-competency]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const competency = this.dataset.competency;
                    const customContainer = document.getElementById(`${competency}-custom-container`);
                    
                    // Hiển thị/ẩn phần nhập tùy chỉnh
                    if (customContainer.classList.contains('show')) {
                        customContainer.classList.remove('show');
                        this.innerHTML = '<i class="fas fa-comment-medical"></i> Thêm nhận xét tùy chỉnh';
                    } else {
                        customContainer.classList.add('show');
                        this.innerHTML = '<i class="fas fa-times"></i> Đóng nhập tùy chỉnh';
                    }
                });
            });
            
            // Xử lý sự kiện mẫu nhanh
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const templateType = this.dataset.template;
                    loadQuickTemplate(templateType);
                });
            });
            
            // Xử lý sự kiện nút sao chép
            document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
            
            // Xử lý sự kiện nút làm mới
            document.getElementById('reset-btn').addEventListener('click', resetForm);
            
            // Xử lý sự kiện nút in
            document.getElementById('print-btn').addEventListener('click', function() {
                // Tối ưu hóa trước khi in
                showToast('Đang chuẩn bị phiếu để in...', 'warning');
                
                // Thêm delay để đảm bảo CSS in được áp dụng
                setTimeout(() => {
                    window.print();
                }, 500);
            });
            
            // Xử lý sự kiện nút lưu mẫu
            document.getElementById('save-template-btn').addEventListener('click', saveTemplate);
            
            // Xử lý sự kiện nút xuất PDF
            document.getElementById('export-pdf-btn').addEventListener('click', exportToPDF);
            
            // Cập nhật preview khi nhập liệu
            const inputs = [
                'studentName', 'className', 'teacherName', 'teacherPhone',
                'grammar-comment', 'vocabulary-comment', 'communication-comment',
                'collaboration-comment', 'critical-thinking-comment', 'digital-literacy-comment',
                'general-comment'
            ];
            
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', updatePreview);
            });
            
            // Khởi tạo gợi ý ban đầu
            const competencies = ['grammar', 'vocabulary', 'communication', 'collaboration', 'criticalThinking', 'digitalLiteracy'];
            competencies.forEach(competency => {
                loadSuggestionsForCompetency(competency, 0);
            });
            
            loadGeneralSuggestions();
            
            // Khởi tạo preview lần đầu
            updatePreview();
            
            // Thêm hướng dẫn sử dụng nhanh
            setTimeout(() => {
                showToast('Chào mừng đến với công cụ nhận xét học sinh!', 'success');
            }, 1000);
        });
    </script>
</body>
</html>
